<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory LamYNmless (Isabelle2016: February 2016)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory LamYNmless</h1>

<span class="command">theory</span> <span class="name">LamYNmless</span><br/>
<span class="keyword">imports</span> <a href="../../HOL/HOL/Main.html"><span class="name">Main</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1">theory</span><span class=""> </span><span class="">LamYNmless</span><span class="">
</span><span class="keyword2">imports</span><span class=""> </span><span class="">Main</span><span class=""> </span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="keyword1">typedecl</span><span class=""> </span><span class="">atom</span><span class="">
</span><span class="keyword1">axiomatization</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">atom_inf</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;infinite (UNIV :: atom set)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">typedecl</span><span class=""> </span><span class="">TV</span><span class="">
</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">type</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">Typ</span><span class=""> </span><span class="">TV</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">Arr</span><span class=""> </span><span class="">type</span><span class=""> </span><span class="">type</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &#8594; _&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">ptrm</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">FVar</span><span class=""> </span><span class="">atom</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">BVar</span><span class=""> </span><span class="">nat</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">App</span><span class=""> </span><span class="">ptrm</span><span class=""> </span><span class="">ptrm</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">Lam</span><span class=""> </span><span class="">ptrm</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">type</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">ctxt</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(atom &#215; type) list&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class=""> </span><span class="">opn</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;nat &#8658; ptrm &#8658; ptrm &#8658; ptrm&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;{_ &#8594; _} _&quot;</span><span class="delimiter">)</span><span class="">  </span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;{k &#8594; u} (FVar x) = FVar x&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;{k &#8594; u} (BVar i) = (if i = k then u else BVar i)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;{k &#8594; u} (App t1 t2) = App ({k &#8594; u} t1)({k &#8594; u} t2)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;{k &#8594; u} (Lam t) = Lam ({(k+1) &#8594; u} t)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;{k &#8594; u} (Y &#963;) = Y &#963;&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">opn&#39;</span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ptrm &#8658; ptrm &#8658; ptrm&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_^_&quot;</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;opn&#39; t u &#8801; {0 &#8594; u} t&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">bvar_0_open_any</span><span class="delimiter">:</span><span class="string">&quot;BVar 0^M = M&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">opn&#39;_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">bvar_Suc_n_open_any</span><span class="delimiter">:</span><span class="string">&quot;(BVar (Suc n))^M = BVar (Suc n)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">opn&#39;_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class=""> </span><span class="">FV</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ptrm &#8658; atom set&quot;</span><span class="">  </span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;FV (FVar x) = {x}&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;FV (BVar i) = {}&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;FV (App t1 t2) = (FV t1) &#8746; (FV t2)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;FV (Lam t) = FV t&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;FV (Y &#963;) = {}&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> </span><span class="">trm</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ptrm &#8658; bool&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">var</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm (FVar x)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">app</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; trm t1 ; trm t2 &#10215; &#10233; trm (App t1 t2)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">lam</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; finite L ; (&#8896;x. x &#8713; L &#10233; trm (t^(FVar x))) &#10215; &#10233; trm (Lam t)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">Y</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm (Y &#963;)&quot;</span><span class="">
</span><span class="keyword1">thm</span><span class=""> </span><span class="">trm.simps</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">bvar_not_trm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm (BVar n) &#10233; False&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">trm.cases</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">x_Ex</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;L:: atom set. finite L &#10233; &#8707;x. x &#8713; L&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">ex_new_if_finite</span><span class=""> </span><span class="">atom_inf</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">FV_finite</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite (FV u)&quot;</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">u</span><span class="delimiter">,</span><span class=""> </span><span class="">auto</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">test</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(trm (Lam (BVar 2)))&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">subst</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">trm.simps</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="">1</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(&#8707;L. finite L &#8743; (&#8704;x. x &#8713; L &#10230; trm (BVar 2)^FVar x))&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;(&#8704;x. x &#8713; L &#10230; trm (BVar 2)^FVar x)&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;x &#8713; L&quot;</span><span class=""> </span><span class="string">&quot;finite L&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">x_Ex</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;trm (BVar 2)^FVar x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">bvar_Suc_n_open_any</span><span class=""> </span><span class="">bvar_not_trm</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> </span><span class="">wf_ctxt</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ctxt &#8658; bool&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">nil</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt []&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">cons</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; x &#8713; fst`set C ; wf_ctxt C &#10215; &#10233; wf_ctxt ((x, &#963;)#C)&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> </span><span class="">wt_trm</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ctxt &#8658; ptrm &#8658; type &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &#8866; _ : _&quot;</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">var</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; wf_ctxt &#915; ; (x,&#963;) &#8712; set &#915; &#10215; &#10233; &#915; &#8866; FVar x : &#963;&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">app</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; &#915; &#8866; t1 : &#964; &#8594; &#963; ; &#915; &#8866; t2 : &#964; &#10215; &#10233; &#915; &#8866; App t1 t2 : &#963;&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">abs</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; finite L ; (&#8896;x. x &#8713; L &#10233; ((x,&#963;)#&#915;) &#8866; (t^(FVar x)) : &#964;) &#10215; &#10233; &#915; &#8866; Lam t : &#963; &#8594; &#964;&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">Y</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; wf_ctxt &#915; &#10215; &#10233;  &#915; &#8866; Y &#963; : (&#963; &#8594; &#963;) &#8594; &#963;&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> </span><span class="">beta_Y</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ptrm &#8658; ptrm &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="keyword2">infix</span><span class=""> </span><span class="string">&quot;&#8658;&quot;</span><span class=""> </span><span class="">300</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">red_L</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; trm N ; M &#8658; M&#39; &#10215; &#10233; App M N &#8658; App M&#39; N&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">red_R</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; trm M ; N &#8658; N&#39; &#10215; &#10233; App M N &#8658; App M N&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">abs</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; finite L ; (&#8896;x. x &#8713; L &#10233; M^(FVar x) &#8658; M&#39;^(FVar x)) &#10215; &#10233; Lam M &#8658; Lam M&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">beta</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; trm (Lam M) ; trm N &#10215; &#10233; App (Lam M) N &#8658; M^N&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Y</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm M &#10233; App (Y &#963;) M &#8658; App M (App (Y &#963;) M)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">test2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Lam (App (Lam (BVar 0)) (FVar x)) &#8658; Lam (FVar x)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;{}&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">abs</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">,</span><span class=""> </span><span class="">thin_tac</span><span class=""> </span><span class="string">&quot;xa &#8713; {}&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn.simps</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">s</span><span class="delimiter">=</span><span class="string">&quot;BVar 0^FVar x&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">subst</span><span class="delimiter">)</span><span class="">
</span><span class="comment">(*is there a nicer way to do this? i.e. subst for the second occurence of FVar x only?*)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">opn&#39;_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">bvar_0_open_any</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">beta</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;{}&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">trm.lam</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">bvar_0_open_any</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">trm.var</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">subst</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ptrm &#8658; atom &#8658; ptrm &#8658; ptrm&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ [_ ::= _]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">90</span><span class="delimiter">,</span><span class=""> </span><span class="">90</span><span class="delimiter">,</span><span class=""> </span><span class="">90</span><span class="delimiter">]</span><span class=""> </span><span class="">90</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;(FVar x)[z ::= u] = (if x = z then u else FVar x)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;(BVar x)[z ::= u] = BVar x&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;(App t1 t2)[z ::= u] = App (t1[z ::= u]) (t2[z ::= u])&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;(Lam t)[z ::= u] = Lam (t[z ::= u])&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;(Y &#963;)[z ::= u] = (Y &#963;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_fresh</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; FV t &#10233; t[x ::= u] = t&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">[</span><span class="">simp_trace</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">subst</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">FV.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">subst</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">Set.insert_iff</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">subst</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">Set.empty_iff</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">subst</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">HOL.simp_thms</span><span class="delimiter">(</span><span class="">31</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_fresh2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; FV t &#10233; t = t[x ::= u]&quot;</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">t</span><span class="delimiter">,</span><span class=""> </span><span class="">auto</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">opn_trm_core</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8800; j &#10233; {j &#8594; v} e = {i &#8594; u}({j &#8594; v} e) &#10233; e = {i &#8594; u} e&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">i</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">opn_trm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm e &#10233; e = {k &#8594; t}e&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">1</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;y &#8713; (L &#8746; FV e)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">FV_finite</span><span class=""> </span><span class="">x_Ex</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">finite_UnI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">j</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">v</span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;FVar y&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">opn_trm_core</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="string">&quot;1&quot;</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="string">&quot;2&quot;</span><span class=""> </span><span class="">opn&#39;_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">opn_trm2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm e &#10233; {k &#8594; t}e = e&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">opn_trm</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_open</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm u &#10233; ({n &#8594; w}t)[x ::= u] = {n &#8594; w [x ::= u]} (t [x ::= u])&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">opn_trm</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_open2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm u &#10233; {n &#8594; w [x ::= u]} (t [x ::= u]) = ({n &#8594; w}t)[x ::= u]&quot;</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">subst_open</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">fvar_subst_simp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8800; y &#10233; FVar y = FVar y[x ::= u]&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">fvar_subst_simp2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;u = FVar x[x ::= u]&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_open_var</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm u &#10233; x &#8800; y &#10233; (t^FVar y)[x ::= u] = (t [x ::= u])^FVar y&quot;</span><span class="">
</span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">fvar_subst_simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">subst_open</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_open_var2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm u &#10233; x &#8800; y &#10233; (t [x ::= u])^FVar y = (t^FVar y)[x ::= u]&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">subst_open_var</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_intro</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm u &#10233; x &#8713; FV t &#10233; (t^FVar x)[x::=u] = t^u&quot;</span><span class="">
</span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">fvar_subst_simp2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class="delimiter">(</span><span class="">10</span><span class="delimiter">)</span><span class=""> </span><span class="">subst_fresh2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">u</span><span class="delimiter">=</span><span class="">u</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">subst_open</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_intro2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm u &#10233; x &#8713; FV t &#10233; t^u = (t^FVar x)[x::=u]&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">subst_intro</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> 
</span><span class="">  </span><span class="">pbeta</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ptrm &#8658; ptrm &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &#8658;&#8741; _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">80</span><span class="delimiter">,</span><span class="">80</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">refl</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(FVar x) &#8658;&#8741; (FVar x)&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">reflY</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Y &#963; &#8658;&#8741; Y &#963;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">app</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; M &#8658;&#8741; M&#39; ; N &#8658;&#8741; N&#39; &#10215; &#10233; App M N &#8658;&#8741; App M&#39; N&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">abs</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; finite L ; (&#8896;x. x &#8713; L &#10233; M^(FVar x) &#8658;&#8741; M&#39;^(FVar x)) &#10215; &#10233; Lam M &#8658;&#8741; Lam M&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">beta</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; finite L ; (&#8896;x. x &#8713; L &#10233; M^(FVar x) &#8658;&#8741; M&#39;^(FVar x)) ; N &#8658;&#8741; N&#39; &#10215; &#10233; App (Lam M) N &#8658;&#8741; M&#39;^N&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Y</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; M &#8658;&#8741; M&#39; &#10215; &#10233; App (Y &#963;) M &#8658;&#8741; App M&#39; (App (Y &#963;) M&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_trm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm e &#10233; trm u &#10233; trm(e[x::=u])&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">var</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">trm.var</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">app</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">trm.Y</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">lam</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm.lam</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; {x}&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open_var2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">trm_opn</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm (Lam M) &#8743; trm N &#10233; trm M^N&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">frule</span><span class=""> </span><span class="">conjE</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">R</span><span class="delimiter">=</span><span class="string">&quot;trm (Lam M)&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">conjE</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">R</span><span class="delimiter">=</span><span class="string">&quot;trm N&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">trm.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">1</span><span class=""> </span><span class="">L</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; L &#8746; FV M&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">FV_finite</span><span class=""> </span><span class="">finite_UnI</span><span class=""> </span><span class="">x_Ex</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm M^FVar x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_intro2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_trm</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M &#8658;&#8741; M&#39; &#10233; trm M &#8743; trm M&#39;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">trm.simps</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.Y</span><span class=""> </span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">trm.simps</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm_opn</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lam</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.Y</span><span class=""> </span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> 
</span><span class="">  </span><span class="">not_abst</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ptrm &#8658; bool&quot;</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;not_abst (FVar x) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_abst (BVar x) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_abst (App t1 t2) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_abst (Lam t) = False&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_abst (Y t) = True&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class=""> 
</span><span class="">  </span><span class="">not_Y</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ptrm &#8658; bool&quot;</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;not_Y (FVar x) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_Y (BVar x) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_Y (App t1 t2) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_Y (Lam t) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_Y (Y t) = False&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> 
</span><span class="">  </span><span class="">pbeta_max</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;ptrm &#8658; ptrm &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &gt;&gt;&gt; _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">80</span><span class="delimiter">,</span><span class="">80</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">refl</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(FVar x) &gt;&gt;&gt; (FVar x)&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">reflY</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Y &#963; &gt;&gt;&gt; Y &#963;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">app</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; not_abst M ; not_Y M ;  M &gt;&gt;&gt; M&#39; ; N &gt;&gt;&gt; N&#39; &#10215; &#10233; App M N &gt;&gt;&gt; App M&#39; N&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">abs</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; finite L ; (&#8896;x. x &#8713; L &#10233; M^(FVar x) &gt;&gt;&gt; M&#39;^(FVar x)) &#10215; &#10233; Lam M &gt;&gt;&gt;  Lam M&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">beta</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; finite L ; (&#8896;x. x &#8713; L &#10233; M^(FVar x) &gt;&gt;&gt; M&#39;^(FVar x)) ; N &gt;&gt;&gt; N&#39; &#10215; &#10233; App (Lam M) N &gt;&gt;&gt; M&#39;^N&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Y</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; M &gt;&gt;&gt; M&#39; &#10215; &#10233; App (Y &#963;) M &gt;&gt;&gt; App M&#39; (App (Y &#963;) M&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">trm_pbeta_max_simp1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M &gt;&gt;&gt; M&#39; &#10233; trm M &#8743; trm M&#39;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta_max.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">trm.simps</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.Y</span><span class=""> </span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta_max.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">trm.simps</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm_opn</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lam</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.Y</span><span class=""> </span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_max_trm_r</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M &gt;&gt;&gt; M&#39; &#10233; trm M&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta_max.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">trm.simps</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="">trm.Y</span><span class=""> </span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_beta&#39;</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite L &#10233; (&#8896;x. x &#8713; L &#10233; M^(FVar x) &#8658;&#8741; M&#39;^(FVar x)) &#10233; N &#8658;&#8741; N&#39; &#10233; App (Lam M) N &#8658;&#8741; {0 &#8594; N&#39;} M&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">pbeta.beta</span><span class=""> </span><span class="">opn&#39;_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Lem2_5_1</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;s &#8658;&#8741; s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;t &#8658;&#8741; t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(s[x ::= t]) &#8658;&#8741; (s&#39;[x ::= t&#39;])&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">refl</span><span class=""> </span><span class="">s</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">reflY</span><span class=""> </span><span class="">s</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">app</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.app</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">app</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; {x}&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">pbeta.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_fresh2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">u</span><span class="delimiter">=</span><span class="">t</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class="delimiter">(</span><span class="">8</span><span class="delimiter">)</span><span class=""> </span><span class="">subst_fresh2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">u</span><span class="delimiter">=</span><span class="">t&#39;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">,</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">UnI1</span><span class=""> </span><span class="">abs.prems</span><span class=""> </span><span class="">opn&#39;_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="">abs.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class=""> </span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">N&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; {x}&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">pbeta_beta&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open_var2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open_var2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Lem2_5_1opn</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8713; L &#10233; s^FVar x &#8658;&#8741; s&#39;^FVar x&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;finite L&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;t &#8658;&#8741; t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;s^t &#8658;&#8741; s&#39;^t&#39;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; L &#8746; FV s &#8746; FV s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">FV_finite</span><span class=""> </span><span class="">infinite_Un</span><span class=""> </span><span class="">x_Ex</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_intro2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">subst_intro2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Lem2_5_1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">not_Y_ex</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(not_Y M) &#10233; &#8707;&#963;. M = Y &#963;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">not_Y.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class=""> </span><span class="">cls</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;nat &#8658; atom &#8658; ptrm &#8658; ptrm&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;{_ &lt;- _} _&quot;</span><span class="delimiter">)</span><span class="">  </span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;{k &lt;- x} (FVar y) = (if x = y then BVar k else FVar y)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;{k &lt;- x} (BVar i) = BVar i&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;{k &lt;- x} (App t1 t2) = App ({k &lt;- x} t1)({k &lt;- x} t2)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;{k &lt;- x} (Lam t) = Lam ({(k+1) &lt;- x} t)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="string">&quot;{k &lt;- x} (Y &#963;) = Y &#963;&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">cls&#39;</span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;atom &#8658; ptrm &#8658; ptrm&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;\\_^_&quot;</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;cls&#39; x t &#8801; {0 &lt;- x} t&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">not_abst_simp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;not_abst M &#10233; not_abst {k &#8594; FVar y} {k &lt;- x} M&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class=""> </span><span class="">opn.simps</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">not_Y_simp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;not_Y M &#10233; not_Y {k &#8594; FVar y} {k &lt;- x} M&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class=""> </span><span class="">opn.simps</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">FV_simp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; x &#8713; FV M ; x &#8800; y &#10215; &#10233; x &#8713; FV {k &#8594; FVar y} M&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class="">k</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">FV_simp2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; FV M &#8746; FV N &#10233; x &#8713; FV {k &#8594; N}M&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class="">k</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">FV_simp3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; FV {k &#8594; N}M &#10233; x &#8713; FV M&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class="">k</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">FV_simp4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; FV M &#10233; x &#8713; FV {k &lt;- y} M&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class="">k</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">FV_simp5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; FV M &#8746; FV N &#10233; x &#8713; FV (M[y ::= N])&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">fv_opn_cls_id</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; FV t &#10233; {k &lt;- x}{k &#8594; FVar x}t = t&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class="">k</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">fv_opn_cls_id2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; FV t &#10233; t = {k &lt;- x}{k &#8594; FVar x}t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">fv_opn_cls_id</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">opn_cls_swap</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; m &#10233; x &#8800; y &#10233; {k &lt;- x}{m &#8594; FVar y}M = {m &#8594; FVar y}{k &lt;- x}M&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class="">k</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">opn_cls_swap2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; m &#10233; x &#8800; y &#10233; {m &#8594; FVar y}{k &lt;- x}M = {k &lt;- x}{m &#8594; FVar y}M&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">opn_cls_swap</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">opn_opn_swap</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; m &#10233; x &#8800; y &#10233; {k &#8594; FVar x}{m &#8594; FVar y}M = {m &#8594; FVar y}{k &#8594; FVar x}M&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class="">k</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">cls_opn_eq_subst</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm M &#10233; ({k &#8594; FVar y} {k &lt;- x} M) = (M[x ::= FVar y])&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">var</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">app</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">lam</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">k</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x&#39; &#8713; L &#8746; {x,y} &#8746; FV t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">FV_finite</span><span class=""> </span><span class="">finite.emptyI</span><span class=""> </span><span class="">finite.insertI</span><span class=""> </span><span class="">finite_UnI</span><span class=""> </span><span class="">x_Ex</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;{Suc k &#8594; FVar y} {Suc k &lt;- x} {0 &#8594; FVar x&#39;} t = ({0 &#8594; FVar x&#39;} t) [x ::= FVar y]&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="string">&quot;lam&quot;</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">FV_simp</span><span class=""> </span><span class="">UnI1</span><span class=""> </span><span class="">UnI2</span><span class=""> </span><span class="">insertCI</span><span class=""> </span><span class="">opn&#39;_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;{0 &#8594; FVar x&#39;} {Suc k &#8594; FVar y} {Suc k &lt;- x} t = {0 &#8594; FVar x&#39;}(t [x ::= FVar y])&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">opn_opn_swap</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">opn_cls_swap2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">subst_open_var</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">UnI2</span><span class=""> </span><span class="">insertI1</span><span class=""> </span><span class="">subst_open</span><span class=""> </span><span class="">trm.var</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;{0 &lt;- x&#39;}{0 &#8594; FVar x&#39;}{Suc k &#8594; FVar y} {Suc k &lt;- x} t = {0 &lt;- x&#39;}{0 &#8594; FVar x&#39;}(t [x ::= FVar y])&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">cls.simps</span><span class=""> </span><span class="">opn.simps</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">fv_opn_cls_id2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x&#39;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">t</span><span class="delimiter">=</span><span class="string">&quot;{k + 1 &#8594; FVar y} {k + 1 &lt;- x} t&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">FV_simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">FV_simp4</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">fv_opn_cls_id2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x&#39;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">t</span><span class="delimiter">=</span><span class="string">&quot;t [x ::= FVar y]&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">FV_simp5</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">cls_opn_eq_subst2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm M &#10233; (M[x ::= FVar y]) =({k &#8594; FVar y} {k &lt;- x} M)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">cls_opn_eq_subst</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_max_beta&#39;</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite L &#10233; (&#8896;x. x &#8713; L &#10233; M^(FVar x) &gt;&gt;&gt; M&#39;^(FVar x)) &#10233; N &gt;&gt;&gt; N&#39; &#10233; App (Lam M) N &gt;&gt;&gt; {0 &#8594; N&#39;} M&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">pbeta_max.beta</span><span class=""> </span><span class="">opn&#39;_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Lem2_5_1_beta_max</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;s &gt;&gt;&gt; s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(s[x ::= FVar y]) &gt;&gt;&gt; (s&#39;[x ::= FVar y])&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta_max.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">refl</span><span class=""> </span><span class="">s</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">reflY</span><span class=""> </span><span class="">s</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">app</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta_max.app</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">app</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">app</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; {x}&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">pbeta_max.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_fresh2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">u</span><span class="delimiter">=</span><span class="string">&quot;FVar y&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class="delimiter">(</span><span class="">8</span><span class="delimiter">)</span><span class=""> </span><span class="">subst_fresh2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">u</span><span class="delimiter">=</span><span class="string">&quot;FVar y&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm.var</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">N&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; {x}&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">pbeta_max_beta&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open_var2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm.var</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open_var2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm.var</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="">trm_pbeta_max_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="">trm_pbeta_max_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm.var</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_max_cls</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;t &gt;&gt;&gt; d &#10233; y &#8713; FV t &#8746; FV d &#8746; {x} &#10233; {k &#8594; FVar y}{k &lt;- x}t &gt;&gt;&gt; {k &#8594; FVar y}{k &lt;- x}d&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">cls_opn_eq_subst</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">cls_opn_eq_subst</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Lem2_5_1_beta_max</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">trm_pbeta_max_simp1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_max_ex</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">a</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;trm a&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;d. a &gt;&gt;&gt; d&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;not_abst t1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;not_Y t1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">1</span><span class=""> </span><span class="">trm1</span><span class=""> </span><span class="">trm2</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="">da</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm1 = Y &#963;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">not_Y_ex</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;App (Y &#963;) trm2 &gt;&gt;&gt; App da (App (Y &#963;) da)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta_max.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">2</span><span class=""> </span><span class="">trm1</span><span class=""> </span><span class="">trm2</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="">da</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">2</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">,</span><span class="">4</span><span class="delimiter">,</span><span class="">5</span><span class="delimiter">,</span><span class="">1</span><span class="delimiter">,</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">trm1</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta_max.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">3</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">4</span><span class="delimiter">:</span><span class="string">&quot;x &#8713; L &#8746; FV t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">FV_finite</span><span class=""> </span><span class="">finite_UnI</span><span class=""> </span><span class="">x_Ex</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;t^FVar x &gt;&gt;&gt; d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;y. y &#8713; FV d &#8746; FV t &#8746; {x} &#10230; t^FVar y &gt;&gt;&gt; (\\x^d)^FVar y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class=""> </span><span class="">cls&#39;_def</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">fv_opn_cls_id2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta_max_cls</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">5</span><span class=""> </span><span class="">opn&#39;_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">FV_simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;FV d &#8746; FV t &#8746; {x}&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">pbeta_max.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">FV_finite</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">6</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_max_closes_pbeta</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">d</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;a &gt;&gt;&gt; d&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;a &#8658;&#8741; b&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;b &#8658;&#8741; d&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta_max.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">refl</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">  
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">refl</span><span class=""> </span><span class="">pbeta.cases</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">reflY</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;b = Y a&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">pbeta.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">al</span><span class=""> </span><span class="">ald</span><span class=""> </span><span class="">ar</span><span class=""> </span><span class="">ard</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">beta</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">pbeta.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">2</span><span class=""> </span><span class="">L&#39;</span><span class=""> </span><span class="">alb</span><span class=""> </span><span class="">arb</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">ih</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;arb &#8658;&#8741; ard&quot;</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8713; L &#8746; L&#39; &#10233; alb^FVar x &#8658;&#8741; ald^FVar x&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; L&#39;&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">Lem2_5_1opn</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">defer</span></span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">2</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">ih</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">1</span><span class=""> </span><span class="">alb</span><span class=""> </span><span class="">arb</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">ih</span><span class="delimiter">:</span><span class="">  </span><span class="string">&quot;arb &#8658;&#8741; ard&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">1</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="">    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">1</span><span class=""> </span><span class="">L&#39;</span><span class=""> </span><span class="">alb&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">ih2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8713; L &#8746; L&#39; &#10233; alb&#39;^FVar x &#8658;&#8741; ald^FVar x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; L&#39;&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">pbeta.beta</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="">ih</span><span class=""> </span><span class="">ih2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">app</span><span class=""> </span><span class="">al</span><span class=""> </span><span class="">ald</span><span class=""> </span><span class="">ar</span><span class=""> </span><span class="">ard</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">app</span><span class="delimiter">(</span><span class="">7</span><span class="delimiter">,</span><span class="">1</span><span class="delimiter">,</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;App al ar&quot;</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">app</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">al</span><span class=""> </span><span class="">ald</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">abs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.cases</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">1</span><span class=""> </span><span class="">L&#39;</span><span class=""> </span><span class="">alb</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">ih</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8713; L &#8746; L&#39; &#10233; alb^FVar x &#8658;&#8741; ald^FVar x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; L&#39;&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">pbeta.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="">ih</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Y</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">&#963;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">Y</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">1</span><span class=""> </span><span class="">M&#39;&#39;</span><span class=""> </span><span class="">N&#39;&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M&#39;&#39; = Y &#963;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">2</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">2</span><span class=""> </span><span class="">M&#39;&#39;</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">2</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.reflY</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Lem2_5_2</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;a &#8658;&#8741; b&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;a &#8658;&#8741; c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;d. b &#8658;&#8741; d &#8743; c &#8658;&#8741; d&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &gt;&gt;&gt; d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">pbeta_max_ex</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;b &#8658;&#8741; d &#8743; c &#8658;&#8741; d&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta_max_closes_pbeta</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta_max_closes_pbeta</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> </span><span class="">close</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(ptrm &#8658; ptrm &#8658; bool) &#8658; ptrm &#8658; ptrm &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_* _  _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">80</span><span class="delimiter">,</span><span class="">80</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">for</span><span class=""> </span><span class="">R</span><span class="delimiter">::</span><span class="string">&quot;ptrm &#8658; ptrm &#8658; bool&quot;</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">base</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;R a b &#10233; R* a b&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">refl</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;R* a a&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">trans</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; R* a b ; R* b c &#10215; &#10233; R* a c&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">DP</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(ptrm &#8658; ptrm &#8658; bool) &#8658; (ptrm &#8658; ptrm &#8658; bool) &#8658; bool&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;DP R T = (&#8704;a b c. R a b &#8743; T a c &#10230; (&#8707;d. T b d &#8743; R c d))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">DP_R_R_imp_DP_R_Rc_pbeta</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;DP pbeta pbeta&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;DP pbeta (close pbeta)&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">DP_def</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">goal1</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">goal1</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">,</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">goal1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">DP_R_R_imp_DP_Rc_Rc_pbeta</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;DP pbeta pbeta&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;DP (close pbeta) (close pbeta)&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">DP_def</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">goal1</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">goal1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">,</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">DP_R_R_imp_DP_R_Rc_pbeta</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">DP_def</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">trm_beta_Y_simp1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M &#8658; M&#39; &#10233; trm M &#8743; trm M&#39;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">beta_Y.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">trm.simps</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.Y</span><span class=""> </span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">beta_Y.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">trm.simps</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm_opn</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lam</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.Y</span><span class=""> </span><span class="">trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_refl</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm s &#10233; s &#8658;&#8741; s&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">M1&#39;</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M &#8658; M&#39; &#10233; M &#8658;&#8741; M&#39;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">beta_Y.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">red_L</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.app</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">trm_beta_Y_simp1</span><span class=""> </span><span class="">red_L</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta_refl</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">red_L</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">red_R</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.app</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta_refl</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">trm_beta_Y_simp1</span><span class=""> </span><span class="">red_R</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">L</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="">L</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">pbeta.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">N</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">beta</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite L&quot;</span><span class=""> </span><span class="string">&quot;&#8704;x. x &#8713; L &#10230; trm (M^FVar x)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">trm.simps</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">finite.intros</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">trm_opn</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="">L</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">pbeta.beta</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta_refl</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta_refl</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">M1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;beta_Y* M M&#39; &#10233; pbeta* M M&#39;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">base</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">M1&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">red_r_close</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;beta_Y* N N&#39; &#10233; trm M &#10233; beta_Y* (App M N) (App M N&#39;)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">red_l_close</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;beta_Y* M M&#39; &#10233; trm N &#10233; beta_Y* (App M N) (App M&#39; N)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">beta_Y_beta&#39;</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;trm (Lam M) &#10233; trm N &#10233; App (Lam M) N &#8658; {0 &#8594; N} M&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">beta_Y.beta</span><span class=""> </span><span class="">opn&#39;_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Lem2_5_1&#39;_beta_Y</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;s &#8658; s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(s[x ::= FVar y]) &#8658; (s&#39;[x ::= FVar y])&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">beta_Y.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">red_L</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">beta_Y.red_L</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">red_L</span><span class=""> </span><span class="">trm.var</span><span class=""> </span><span class="">subst_trm</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">red_R</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">N&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">beta_Y.red_R</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">red_R</span><span class=""> </span><span class="">trm.var</span><span class=""> </span><span class="">subst_trm</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; {x}&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">beta_Y.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_fresh2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">u</span><span class="delimiter">=</span><span class="string">&quot;FVar y&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class="delimiter">(</span><span class="">8</span><span class="delimiter">)</span><span class=""> </span><span class="">subst_fresh2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">u</span><span class="delimiter">=</span><span class="string">&quot;FVar y&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm.var</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">N</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm.var</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">beta_Y_beta&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="">trm.var</span><span class=""> </span><span class="">subst_trm</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">trm.var</span><span class=""> </span><span class="">subst_trm</span><span class=""> </span><span class="">subst.simps</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">Y</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">trm.var</span><span class=""> </span><span class="">subst_trm</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class=""> 
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">beta_Y_lam_cls</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &#8658; b &#10233; Lam {0 &lt;- x} a &#8658; Lam {0 &lt;- x} b&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;{}&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">beta_Y.abs</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">cls_opn_eq_subst</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">trm_beta_Y_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">cls_opn_eq_subst</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">trm_beta_Y_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Lem2_5_1&#39;_beta_Y</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">abs_close</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; &#8896;x. x &#8713; L &#10233; beta_Y* (M^FVar x) (M&#39;^FVar x) ; finite L &#10215; &#10233; beta_Y* (Lam M) (Lam M&#39;)&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">1</span><span class="">
</span><span class="">  </span><span class="keyword1">note</span><span class=""> </span><span class="">11</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">1</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; L &#8746; FV M &#8746; FV M&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">FV_finite</span><span class=""> </span><span class="">finite_UnI</span><span class=""> </span><span class="">x_Ex</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;op &#8658;* M^FVar x  M&#39;^FVar x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class="">fv_opn_cls_id2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="">fv_opn_cls_id2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">opn&#39;_def</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">base</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">beta_Y_lam_cls</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">M2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pbeta* M M&#39; &#10233; beta_Y* M M&#39;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">refl</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.refl</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">trans</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">base</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="">refl</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.refl</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="">reflY</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.refl</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">app</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">N&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">=</span><span class="string">&quot;App M N&#39;&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">red_r_close</span><span class=""> </span><span class="">app.hyps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">,</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">red_l_close</span><span class=""> </span><span class="">app.hyps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">,</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="">L</span><span class=""> </span><span class="keyword2">in</span><span class="">  </span><span class="">abs_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">N&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">=</span><span class="string">&quot;App (Lam M&#39;) N&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">red_l_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="">L</span><span class=""> </span><span class="keyword2">in</span><span class="">  </span><span class="">abs_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">=</span><span class="string">&quot;App (Lam M&#39;) N&#39;&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">red_r_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="">L</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">trm.lam</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.base</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">beta_Y.beta</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="">L</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">trm.lam</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Y</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">&#963;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">=</span><span class="string">&quot;App M (App (Y &#963;) M)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.base</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">beta_Y.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">=</span><span class="string">&quot;App M&#39; (App (Y &#963;) M)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">red_l_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">red_r_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">red_r_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">trm_pbeta_simp1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt ((x, &#963;)#&#915;) &#10233; wf_ctxt &#915; &#8743; x &#8713; fst`set &#915;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wf_ctxt.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#963; &#10233; wf_ctxt &#915;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">x_Ex</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">opn_typ_aux</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(x, &#964;) # &#915; &#8866; FVar y : &#963; &#10233; x = y &#10233; &#964; = &#963;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">ccontr</span><span class="delimiter">,</span><span class=""> </span><span class="">goal_cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">1</span><span class=""> 
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;wf_ctxt ((y, &#964;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;y &#8713; fst`set &#915;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(y, &#963;) &#8713; set &#915;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(y, &#963;) &#8713; set ((y, &#964;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(y, &#963;) &#8712; set ((y, &#964;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">weakening</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">&#915;&#39;</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">&#963;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#963;&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;set &#915; &#8838; set &#915;&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;wf_ctxt &#915;&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#915;&#39; &#8866; M : &#963;&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class="">&#915;&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">var</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_trm.var</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">var</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">app</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">app</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">&#964;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8713; (L &#8746; fst ` set &#915;&#39;) &#10233; wf_ctxt ((x, &#963;) # &#915;&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; fst ` set &#915;&#39;&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">wt_trm.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">abs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">wt_trm.Y</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">wf_ctxt_exchange</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt ((x,&#963;) # (y,&#960;) # &#915;) &#10233; wf_ctxt ((y,&#960;) # (x,&#963;) # &#915;)&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">1</span><span class=""> 
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;wf_ctxt ((y,&#960;) # &#915;) &#8743; x &#8713; fst`set ((y,&#960;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt ((y,&#960;) # &#915;)&quot;</span><span class=""> </span><span class="string">&quot;x &#8713; fst`set ((y,&#960;) # &#915;)&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt &#915; &#8743; y &#8713; fst`set &#915;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; fst`set &#915;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;y &#8713; fst`set((x,&#963;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">4</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">  
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">exchange</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(x,&#963;) # (y,&#960;) # &#915; &#8866; M : &#948; &#10233; (y,&#960;) # (x,&#963;) # &#915; &#8866; M : &#948;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">1</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;set ((x,&#963;) # (y,&#960;) # &#915;) &#8838; set ((y,&#960;) # (x,&#963;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">weakening</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="">wf_ctxt_exchange</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">trm_wt_trm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#963; &#10233; trm M&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">trm.simps</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">trm.simps</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_typ</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;trm M&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;((x,&#964;)#&#915;) &#8866; M : &#963;&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N : &#964;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M[x ::= N] : &#963;&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">var</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;x = y&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="">True</span><span class=""> 
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">True</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">var</span><span class=""> </span><span class="">opn_typ_aux</span><span class=""> </span><span class="">True</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="">False</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">var</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt &#915;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">var</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(y,&#963;) &#8712; set ((x, &#964;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">False</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(y,&#963;) &#8712; set &#915;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">False</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">wt_trm.var</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">app</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">N&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">app</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#960;</span><span class=""> </span><span class="keyword2">where</span><span class="">  </span><span class="string">&quot;(x, &#964;) # &#915; &#8866; M&#39; : &#960; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;(x, &#964;) # &#915; &#8866; N&#39; : &#960;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">app</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">,</span><span class="">4</span><span class="delimiter">,</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">ih</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M&#39;[x ::= N] : &#960; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N&#39;[x ::= N] : &#960;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">ih</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">lam</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">lam</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#960;</span><span class=""> </span><span class="">&#948;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#963; = &#960; &#8594; &#948;&quot;</span><span class=""> </span><span class="string">&quot;(x, &#964;) # &#915; &#8866; Lam M : &#960; &#8594; &#948;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8707;L. finite L &#8743; (&#8704;x&#39;. x&#39; &#8713; L &#10230; (x&#39;, &#960;) # (x, &#964;) # &#915; &#8866; M^FVar x&#39; : &#948;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">subst</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">wt_trm.simps</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">L&#39;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite L&#39;&quot;</span><span class=""> </span><span class="string">&quot;&#8896;x&#39;. x&#39; &#8713; L&#39; &#10233; (x&#39;, &#960;) # (x, &#964;) # &#915; &#8866; M^FVar x&#39; : &#948;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                                                         
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">2</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x&#39;. x&#39; &#8713; L&#39; &#10233; (x, &#964;) # (x&#39;, &#960;) # &#915; &#8866; M^FVar x&#39; : &#948;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">exchange</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst.simps</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; L&#39; &#8746; {x} &#8746; fst ` set &#915;&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">wt_trm.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_open_var2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">trm_wt_trm</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">lam</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">3</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">weakening</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wf_ctxt.cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">lam</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Y</span><span class=""> </span><span class="">&#947;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">Y</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#963; = (&#947; &#8594; &#947;) &#8594; &#947;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class=""> </span><span class="">1</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_trm.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">opn_typ</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">L</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;finite L&quot;</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8713; L &#10233; ((x,&#964;)#&#915;) &#8866; M^FVar x : &#963;&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N : &#964;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M^N : &#963;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8713; L &#8746; FV M&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">FV_finite</span><span class=""> </span><span class="">finite_UnI</span><span class=""> </span><span class="">x_Ex</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((x,&#964;)#&#915;) &#8866; M^FVar x : &#963;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst_intro2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">x</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm_wt_trm</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">subst_typ</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trm_wt_trm</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">beta_Y_typ</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#963;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;M &#8658; M&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M&#39; : &#963;&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">,</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class="">  </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">beta_Y.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">red_L</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">red_L</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#964;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#964; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N : &#964;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">red_L</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M&#39; : &#964; &#8594; &#963;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">red_R</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">N&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">red_R</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#964;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#964; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N : &#964;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">red_R</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N&#39; : &#964;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">abs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#960;</span><span class=""> </span><span class="">&#964;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#963; = &#960; &#8594; &#964;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; Lam M : &#960; &#8594; &#964;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">abs.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8707;L. finite L &#8743; (&#8704;x. x &#8713; L &#10230; (x, &#960;) # &#915; &#8866; M^FVar x : &#964;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">subst</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">wt_trm.simps</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">L&#39;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite L&#39;&quot;</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8713; L&#39; &#10233; (x, &#960;) # &#915; &#8866; M^FVar x : &#964;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8713; L &#8746; L&#39; &#10233; ((x,&#960;)#&#915;) &#8866; M&#39;^FVar x : &#964;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">abs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="string">&quot;L &#8746; L&#39;&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">wt_trm.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">N</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">beta</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#964;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; (Lam M) : &#964; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N : &#964;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;L. finite L &#8743; (&#8704;x. x &#8713; L &#10230; (x, &#964;) # &#915; &#8866; M^FVar x : &#963;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">subst</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">wt_trm.simps</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">L</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite L&quot;</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8713; L &#10233; (x, &#964;) # &#915; &#8866; M^FVar x : &#963;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">L</span><span class="delimiter">=</span><span class="">L</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">opn_typ</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Y</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">&#964;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">Y</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#960;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; (Y &#964;) : &#960; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#960;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#915; &#8866; (Y &#964;) : (&#964; &#8594; &#964;) &#8594; &#964;&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_trm.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#960; &#8594; &#963; = (&#964; &#8594; &#964;) &#8594; &#964;&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_trm.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#960; = &#964; &#8594; &#964;&quot;</span><span class=""> </span><span class="string">&quot;&#963; = &#964;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">2</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_trm.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_trm.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">2</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">beta_Y_c_typ</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#963;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;beta_Y* M M&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M&#39; : &#963;&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">,</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">beta_Y_typ</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">church_rosser_typ</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;&#915; &#8866; a : &#963;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;beta_Y* a b&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;beta_Y* a c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;d. beta_Y* b d &#8743; beta_Y* c d &#8743; &#915; &#8866; d : &#963;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;pbeta* a b&quot;</span><span class=""> </span><span class="string">&quot;pbeta* a c&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">M1</span><span class=""> </span><span class="">base</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;pbeta* b d&quot;</span><span class=""> </span><span class="string">&quot;pbeta* c d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">DP_R_R_imp_DP_Rc_Rc_pbeta</span><span class=""> </span><span class="">DP_def</span><span class=""> </span><span class="">Lem2_5_2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">M2</span><span class=""> </span><span class="">beta_Y_c_typ</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword2">end</span></pre>

</div>
</body>
</html>
