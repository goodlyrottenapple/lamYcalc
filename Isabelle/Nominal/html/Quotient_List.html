<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory Quotient_List (Isabelle2016: February 2016)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory Quotient_List</h1>

<span class="command">theory</span> <span class="name">Quotient_List</span><br/>
<span class="keyword">imports</span> <a href="Quotient_Set.html"><span class="name">Quotient_Set</span></a> <a href="Quotient_Product.html"><span class="name">Quotient_Product</span></a> <a href="Quotient_Option.html"><span class="name">Quotient_Option</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment">(*  Title:      HOL/Library/Quotient_List.thy
    Author:     Cezary Kaliszyk and Christian Urban
*)</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="cartouche">&#8249;Quotient infrastructure for the list type&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1">theory</span><span class=""> </span><span class="">Quotient_List</span><span class="">
</span><span class="keyword2">imports</span><span class=""> </span><span class="">Main</span><span class=""> </span><span class="">Quotient_Set</span><span class=""> </span><span class="">Quotient_Product</span><span class=""> </span><span class="">Quotient_Option</span><span class="">
</span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="cartouche">&#8249;Rules for the Quotient package&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">map_id</span><span class=""> </span><span class="delimiter">[</span><span class="">id_simps</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;map id = id&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">fact</span><span class=""> </span><span class="">List.map.id</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">list_all2_eq</span><span class=""> </span><span class="delimiter">[</span><span class="">id_simps</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;list_all2 (op =) = (op =)&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">ext</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword3">fix</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">ys</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;list_all2 (op =) xs ys &#10231; xs = ys&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">ys</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">list_induct2&#39;</span><span class="delimiter">)</span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">reflp_list_all2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;reflp R&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;reflp (list_all2 R)&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">reflpI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;xs. R xs xs&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">reflpE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">fix</span><span class=""> </span><span class="">xs</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;list_all2 R xs xs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">xs</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">*</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">list_symp</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;symp R&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;symp (list_all2 R)&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">sympI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;xs ys. R xs ys &#10233; R ys xs&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">sympE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">fix</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">ys</span><span class="">
</span><span class="">  </span><span class="keyword3">assume</span><span class=""> </span><span class="string">&quot;list_all2 R xs ys&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;list_all2 R ys xs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">ys</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">list_induct2&#39;</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">*</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">list_transp</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;transp R&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;transp (list_all2 R)&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">transpI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;xs ys zs. R xs ys &#10233; R ys zs &#10233; R xs zs&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">transpE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">fix</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">ys</span><span class=""> </span><span class="">zs</span><span class="">
</span><span class="">  </span><span class="keyword3">assume</span><span class=""> </span><span class="string">&quot;list_all2 R xs ys&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;list_all2 R ys zs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;list_all2 R xs zs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">zs</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">list_all2_Cons1</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">*</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">list_equivp</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_equiv</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;equivp R &#10233; equivp (list_all2 R)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">blast</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">equivpI</span><span class=""> </span><span class="">reflp_list_all2</span><span class=""> </span><span class="">list_symp</span><span class=""> </span><span class="">list_transp</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class=""> </span><span class="">equivpE</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">list_quotient3</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_thm</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;Quotient3 R Abs Rep&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;Quotient3 (list_all2 R) (map Abs) (map Rep)&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Quotient3I</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8896;x. Abs (Rep x) = x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8896;xs. map Abs (map Rep xs) = xs&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">comp_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8896;x y. R (Rep x) (Rep y) &#10231; x = y&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Quotient3_rel_rep</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8896;xs. list_all2 R (map Rep xs) (map Rep xs)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">list_all2_map1</span><span class=""> </span><span class="">list_all2_map2</span><span class=""> </span><span class="">list_all2_eq</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">fix</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">ys</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8896;x y. R x x &#8743; R y y &#8743; Abs x = Abs y &#10231; R x y&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Quotient3_rel</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;list_all2 R xs ys &#10231; list_all2 R xs xs &#8743; list_all2 R ys ys &#8743; map Abs xs = map Abs ys&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">ys</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">list_induct2&#39;</span><span class="delimiter">)</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">[</span><span class="">mapQ3</span><span class=""> </span><span class="">list</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="delimiter">(</span><span class="">list_all2</span><span class="delimiter">,</span><span class=""> </span><span class="">list_quotient3</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">cons_prs</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_preserve</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">q</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R Abs Rep&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(Rep ---&gt; (map Rep) ---&gt; (map Abs)) (op #) = (op #)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fun_eq_iff</span><span class=""> </span><span class="">comp_def</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class=""> </span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">q</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">cons_rsp</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_respect</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">q</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R Abs Rep&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(R ===&gt; list_all2 R ===&gt; list_all2 R) (op #) (op #)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">nil_prs</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_preserve</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">q</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R Abs Rep&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;map Abs [] = []&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">nil_rsp</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_respect</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">q</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R Abs Rep&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;list_all2 R [] []&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">map_prs_aux</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R1 abs1 rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R2 abs2 rep2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(map abs2) (map ((abs1 ---&gt; rep2) f) (map rep1 l)) = map f l&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">l</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">b</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">map_prs</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_preserve</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R1 abs1 rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R2 abs2 rep2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;((abs1 ---&gt; rep2) ---&gt; (map rep1) ---&gt; (map abs2)) map = map&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;((abs1 ---&gt; id) ---&gt; map rep1 ---&gt; id) map = map&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fun_eq_iff</span><span class=""> </span><span class="">map_prs_aux</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="delimiter">]</span><span class=""> </span><span class="">comp_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">b</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">map_rsp</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_respect</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">q1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R1 Abs1 Rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">q2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R2 Abs2 Rep2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;((R1 ===&gt; R2) ===&gt; (list_all2 R1) ===&gt; list_all2 R2) map map&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;((R1 ===&gt; op =) ===&gt; (list_all2 R1) ===&gt; op =) map map&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">list_all2_eq</span><span class=""> </span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">list.map_transfer</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">foldr_prs_aux</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R1 abs1 rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R2 abs2 rep2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;abs2 (foldr ((abs1 ---&gt; abs2 ---&gt; rep2) f) (map rep1 l) (rep2 e)) = foldr f l e&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">l</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">b</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">foldr_prs</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_preserve</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R1 abs1 rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R2 abs2 rep2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;((abs1 ---&gt; abs2 ---&gt; rep2) ---&gt; (map rep1) ---&gt; rep2 ---&gt; abs2) foldr = foldr&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fun_eq_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fun_eq_iff</span><span class=""> </span><span class="">foldr_prs_aux</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">foldl_prs_aux</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R1 abs1 rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R2 abs2 rep2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;abs1 (foldl ((abs1 ---&gt; abs2 ---&gt; rep1) f) (rep1 e) (map rep2 l)) = foldl f e l&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">l</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class="">e</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">b</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">foldl_prs</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_preserve</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R1 abs1 rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R2 abs2 rep2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;((abs1 ---&gt; abs2 ---&gt; rep1) ---&gt; rep1 ---&gt; (map rep2) ---&gt; abs1) foldl = foldl&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fun_eq_iff</span><span class=""> </span><span class="">foldl_prs_aux</span><span class=""> </span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="comment">(* induct_tac doesn&#39;t accept &#39;arbitrary&#39;, so we manually &#39;spec&#39; *)</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">foldl_rsp</span><span class="delimiter">[</span><span class="">quot_respect</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">q1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R1 Abs1 Rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">q2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R2 Abs2 Rep2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;((R1 ===&gt; R2 ===&gt; R1) ===&gt; R1 ===&gt; list_all2 R2 ===&gt; R1) foldl foldl&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">foldl_transfer</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">foldr_rsp</span><span class="delimiter">[</span><span class="">quot_respect</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">q1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R1 Abs1 Rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">q2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R2 Abs2 Rep2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;((R1 ===&gt; R2 ===&gt; R2) ===&gt; list_all2 R1 ===&gt; R2 ===&gt; R2) foldr foldr&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">foldr_transfer</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">list_all2_rsp</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">r</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;x y. R x y &#10230; (&#8704;a b. R a b &#10230; S x a = T y b)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">l1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;list_all2 R x y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">l2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;list_all2 R a b&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;list_all2 S x a = list_all2 T y b&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">l1</span><span class=""> </span><span class="">l2</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">list_all2_induct</span><span class="delimiter">,</span><span class="">
</span><span class="">    </span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">list_all2_Cons1</span><span class=""> </span><span class="">list_all2_Cons2</span><span class=""> </span><span class="">r</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_respect</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;((R ===&gt; R ===&gt; op =) ===&gt; list_all2 R ===&gt; list_all2 R ===&gt; op =) list_all2 list_all2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">list.rel_transfer</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_preserve</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R abs1 rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;((abs1 ---&gt; abs1 ---&gt; id) ---&gt; map rep1 ---&gt; map rep1 ---&gt; id) list_all2 = list_all2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fun_eq_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct_tac</span><span class=""> </span><span class="">xa</span><span class=""> </span><span class="">xb</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">list_induct2&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_preserve</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R abs1 rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(list_all2 ((rep1 ---&gt; rep1 ---&gt; id) R) l m) = (l = m)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">l</span><span class=""> </span><span class="">m</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">list_induct2&#39;</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Quotient3_rel_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">list_all2_find_element</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8712; set a&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;list_all2 R a b&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;y. (y &#8712; set b &#8743; R x y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">induct</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">list_all2_refl</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x y. R x y = (R x = R y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;list_all2 R x x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword2">end</span><span class="">
</span></pre>

</div>
</body>
</html>
