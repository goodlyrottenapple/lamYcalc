<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory Nominal2_Abs (Isabelle2016: February 2016)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory Nominal2_Abs</h1>

<span class="command">theory</span> <span class="name">Nominal2_Abs</span><br/>
<span class="keyword">imports</span> <a href="Nominal2_Base.html"><span class="name">Nominal2_Base</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1">theory</span><span class=""> </span><span class="">Nominal2_Abs</span><span class="">
</span><span class="keyword2">imports</span><span class=""> </span><span class="string">&quot;Nominal2_Base&quot;</span><span class=""> 
</span><span class="">        </span><span class="string">&quot;~~/src/HOL/Quotient&quot;</span><span class=""> 
</span><span class="">        </span><span class="string">&quot;~~/src/HOL/Library/Quotient_List&quot;</span><span class="">
</span><span class="">        </span><span class="string">&quot;~~/src/HOL/Library/Quotient_Product&quot;</span><span class=""> 
</span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Abstractions *}</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class="">
</span><span class="">  </span><span class="">alpha_set</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">alpha_set</span><span class="delimiter">[</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;alpha_set (bs, x) R f p (cs, y) &#10231; 
     f x - bs = f y - cs &#8743; 
     (f x - bs) &#9839;* p &#8743; 
     R (p &#8729; x) y &#8743;
     p &#8729; bs = cs&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class="">
</span><span class="">  </span><span class="">alpha_res</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">alpha_res</span><span class="delimiter">[</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;alpha_res (bs, x) R f p (cs, y) &#10231; 
     f x - bs = f y - cs &#8743; 
     (f x - bs) &#9839;* p &#8743; 
     R (p &#8729; x) y&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class="">
</span><span class="">  </span><span class="">alpha_lst</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">alpha_lst</span><span class="delimiter">[</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;alpha_lst (bs, x) R f p (cs, y) &#10231; 
     f x - set bs = f y - set cs &#8743; 
     (f x - set bs) &#9839;* p &#8743; 
     R (p &#8729; x) y &#8743;
     p &#8729; bs = cs&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemmas</span><span class=""> </span><span class="">alphas</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">alpha_set.simps</span><span class=""> </span><span class="">alpha_res.simps</span><span class=""> </span><span class="">alpha_lst.simps</span><span class="">
</span><span class="">
</span><span class="keyword1">notation</span><span class="">
</span><span class="">  </span><span class="">alpha_set</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &#8776;set _ _ _ _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">]</span><span class=""> </span><span class="">100</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">  </span><span class="">alpha_res</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &#8776;res _ _ _ _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">]</span><span class=""> </span><span class="">100</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">  </span><span class="">alpha_lst</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &#8776;lst _ _ _ _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">]</span><span class=""> </span><span class="">100</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Mono *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">mono</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;R1 &#8804; R2 &#10233; alpha_set bs R1 &#8804; alpha_set bs R2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;R1 &#8804; R2 &#10233; alpha_res bs R1 &#8804; alpha_res bs R2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;R1 &#8804; R2 &#10233; alpha_lst cs R1 &#8804; alpha_lst cs R2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">bs</span><span class="delimiter">,</span><span class=""> </span><span class="">case_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">cs</span><span class="delimiter">)</span><span class=""> 
</span><span class="">     </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">le_fun_def</span><span class=""> </span><span class="">le_bool_def</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Equivariance *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_eqvt</span><span class="delimiter">[</span><span class="">eqvt</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;set R f q (cs, y) &#10233; (p &#8729; bs, p &#8729; x) &#8776;set (p &#8729; R) (p &#8729; f) (p &#8729; q) (p &#8729; cs, p &#8729; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(bs, x) &#8776;res R f q (cs, y) &#10233; (p &#8729; bs, p &#8729; x) &#8776;res (p &#8729; R) (p &#8729; f) (p &#8729; q) (p &#8729; cs, p &#8729; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(ds, x) &#8776;lst R f q (es, y) &#10233; (p &#8729; ds, p &#8729; x) &#8776;lst (p &#8729; R) (p &#8729; f) (p &#8729; q) (p &#8729; es, p &#8729; y)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">permute_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">permute_fun_app_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">Diff_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">eq_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_bool_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Equivalence *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_refl</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;R x x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;set R f 0 (bs, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(bs, x) &#8776;res R f 0 (bs, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(cs, x) &#8776;lst R f 0 (cs, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_zero_perm</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_sym</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;R (p &#8729; x) y &#10233; R (- p &#8729; y) x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;set R f p (cs, y) &#10233; (cs, y) &#8776;set R f (- p) (bs, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(bs, x) &#8776;res R f p (cs, y) &#10233; (cs, y) &#8776;res R f (- p) (bs, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(ds, x) &#8776;lst R f p (es, y) &#10233; (es, y) &#8776;lst R f (- p) (ds, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_minus_perm</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_trans</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;R (p &#8729; x) y; R (q &#8729; y) z&#10215; &#10233; R ((q + p) &#8729; x) z&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#10214;(bs, x) &#8776;set R f p (cs, y); (cs, y) &#8776;set R f q (ds, z)&#10215; &#10233; (bs, x) &#8776;set R f (q + p) (ds, z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;&#10214;(bs, x) &#8776;res R f p (cs, y); (cs, y) &#8776;res R f q (ds, z)&#10215; &#10233; (bs, x) &#8776;res R f (q + p) (ds, z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;&#10214;(es, x) &#8776;lst R f p (gs, y); (gs, y) &#8776;lst R f q (hs, z)&#10215; &#10233; (es, x) &#8776;lst R f (q + p) (hs, z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_plus_perm</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_sym_eqvt</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;R (p &#8729; x) y &#10233; R y (p &#8729; x)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p &#8729; R = R&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;set R f p (cs, y) &#10233; (cs, y) &#8776;set R f (- p) (bs, x)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(bs, x) &#8776;res R f p (cs, y) &#10233; (cs, y) &#8776;res R f (- p) (bs, x)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(ds, x) &#8776;lst R f p (es, y) &#10233; (es, y) &#8776;lst R f (- p) (ds, x)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span class=""> </span><span class="">alpha_sym</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;p&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">permute_boolE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">permute_self</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_set_trans_eqvt</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs, y) &#8776;set R f q (ds, z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;set R f p (cs, y)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">d</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; R = R&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">c</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;R (p &#8729; x) y; R y (- q &#8729; z)&#10215; &#10233; R (p &#8729; x) (- q &#8729; z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;set R f (q + p) (ds, z)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">alpha_trans</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;q&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">permute_boolE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="">permute_self</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rotate_tac</span><span class=""> </span><span class="">-</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;q&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">permute_boolI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="">permute_self</span><span class=""> </span><span class="">permute_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_res_trans_eqvt</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class="">  </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs, y) &#8776;res R f q (ds, z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;res R f p (cs, y)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">d</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; R = R&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">c</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;R (p &#8729; x) y; R y (- q &#8729; z)&#10215; &#10233; R (p &#8729; x) (- q &#8729; z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;res R f (q + p) (ds, z)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">alpha_trans</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;q&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">permute_boolE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="">permute_self</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rotate_tac</span><span class=""> </span><span class="">-</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;q&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">permute_boolI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="">permute_self</span><span class=""> </span><span class="">permute_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_lst_trans_eqvt</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs, y) &#8776;lst R f q (ds, z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;lst R f p (cs, y)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">d</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; R = R&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">c</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;R (p &#8729; x) y; R y (- q &#8729; z)&#10215; &#10233; R (p &#8729; x) (- q &#8729; z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;lst R f (q + p) (ds, z)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">alpha_trans</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;q&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">permute_boolE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="">permute_self</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rotate_tac</span><span class=""> </span><span class="">-</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;q&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">permute_boolI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="">permute_self</span><span class=""> </span><span class="">permute_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemmas</span><span class=""> </span><span class="">alpha_trans_eqvt</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">alpha_set_trans_eqvt</span><span class=""> </span><span class="">alpha_res_trans_eqvt</span><span class=""> </span><span class="">alpha_lst_trans_eqvt</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* General Abstractions *}</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class="">
</span><span class="">  </span><span class="">alpha_abs_set</span><span class=""> 
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="delimiter">[</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;alpha_abs_set (bs, x) (cs, y) &#10231; (&#8707;p. (bs, x) &#8776;set (op=) supp p (cs, y))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class="">
</span><span class="">  </span><span class="">alpha_abs_lst</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="delimiter">[</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;alpha_abs_lst (bs, x) (cs, y) &#10231; (&#8707;p. (bs, x) &#8776;lst (op=) supp p (cs, y))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class="">
</span><span class="">  </span><span class="">alpha_abs_res</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="delimiter">[</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;alpha_abs_res (bs, x) (cs, y) &#10231; (&#8707;p. (bs, x) &#8776;res (op=) supp p (cs, y))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">notation</span><span class="">
</span><span class="">  </span><span class="">alpha_abs_set</span><span class=""> </span><span class="delimiter">(</span><span class="keyword2">infix</span><span class=""> </span><span class="string">&quot;&#8776;abs&#39;_set&quot;</span><span class=""> </span><span class="">50</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">  </span><span class="">alpha_abs_lst</span><span class=""> </span><span class="delimiter">(</span><span class="keyword2">infix</span><span class=""> </span><span class="string">&quot;&#8776;abs&#39;_lst&quot;</span><span class=""> </span><span class="">50</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">  </span><span class="">alpha_abs_res</span><span class=""> </span><span class="delimiter">(</span><span class="keyword2">infix</span><span class=""> </span><span class="string">&quot;&#8776;abs&#39;_res&quot;</span><span class=""> </span><span class="">50</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemmas</span><span class=""> </span><span class="">alphas_abs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">alpha_abs_set.simps</span><span class=""> </span><span class="">alpha_abs_res.simps</span><span class=""> </span><span class="">alpha_abs_lst.simps</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alphas_abs_refl</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;abs_set (bs, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(bs, x) &#8776;abs_res (bs, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(cs, x) &#8776;abs_lst (cs, x)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas_abs</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;0&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_zero_perm</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alphas_abs_sym</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;abs_set (cs, y) &#10233; (cs, y) &#8776;abs_set (bs, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(bs, x) &#8776;abs_res (cs, y) &#10233; (cs, y) &#8776;abs_res (bs, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(ds, x) &#8776;abs_lst (es, y) &#10233; (es, y) &#8776;abs_lst (ds, x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas_abs</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">exE</span><span class="delimiter">,</span><span class=""> </span><span class="">rule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;-p&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_minus_perm</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alphas_abs_trans</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#10214;(bs, x) &#8776;abs_set (cs, y); (cs, y) &#8776;abs_set (ds, z)&#10215; &#10233; (bs, x) &#8776;abs_set (ds, z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;&#10214;(bs, x) &#8776;abs_res (cs, y); (cs, y) &#8776;abs_res (ds, z)&#10215; &#10233; (bs, x) &#8776;abs_res (ds, z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;&#10214;(es, x) &#8776;abs_lst (gs, y); (gs, y) &#8776;abs_lst (hs, z)&#10215; &#10233; (es, x) &#8776;abs_lst (hs, z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas_abs</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">exE</span><span class="delimiter">,</span><span class=""> </span><span class="">erule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">exE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;pa + p&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_plus_perm</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alphas_abs_eqvt</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(bs, x) &#8776;abs_set (cs, y) &#10233; (p &#8729; bs, p &#8729; x) &#8776;abs_set (p &#8729; cs, p &#8729; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(bs, x) &#8776;abs_res (cs, y) &#10233; (p &#8729; bs, p &#8729; x) &#8776;abs_res (p &#8729; cs, p &#8729; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(ds, x) &#8776;abs_lst (es, y) &#10233; (p &#8729; ds, p &#8729; x) &#8776;abs_lst (p &#8729; es, p &#8729; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas_abs</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">supp_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">Diff_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">exE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;p &#8729; pa&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_permute_iff</span><span class=""> </span><span class="">permute_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Strengthening the equivalence *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">disjoint_right_eq</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;A &#8746; B1 = A &#8746; B2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;A &#8745; B1 = {}&quot;</span><span class=""> </span><span class="string">&quot;A &#8745; B2 = {}&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;B1 = B2&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_Un_distrib2</span><span class=""> </span><span class="">Int_absorb2</span><span class=""> </span><span class="">Int_commute</span><span class=""> </span><span class="">Un_upper2</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">supp_property_res</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;res (op =) supp p (as&#39;, x&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;p &#8729; (supp x &#8745; as) = supp x&#39; &#8745; as&#39;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(supp x - as) &#9839;* p&quot;</span><span class=""> </span><span class="keyword1">by</span><span class="">  </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p &#8729; (supp x - as) = (supp x - as)&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">atom_set_perm_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(supp x&#39; - as&#39;) &#8746; (supp x&#39; &#8745; as&#39;) = supp x&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = supp (p &#8729; x)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = p &#8729; (supp x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = p &#8729; ((supp x - as) &#8746; (supp x &#8745; as))&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (p &#8729; (supp x - as)) &#8746; (p &#8729; (supp x &#8745; as))&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">union_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; (p &#8729; (supp x &#8745; as))&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x&#39; - as&#39;) &#8746; (p &#8729; (supp x &#8745; as))&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(supp x&#39; - as&#39;) &#8746; (supp x&#39; &#8745; as&#39;) = (supp x&#39; - as&#39;) &#8746; (p &#8729; (supp x &#8745; as))&quot;</span><span class=""> </span><span class="keyword1">.</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(supp x&#39; - as&#39;) &#8745; (supp x&#39; &#8745; as&#39;) = {}&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(supp x - as) &#8745; (supp x &#8745; as) = {}&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p &#8729; ((supp x - as) &#8745; (supp x &#8745; as) = {})&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_bool_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(p &#8729; (supp x - as)) &#8745; (p &#8729; (supp x &#8745; as)) = {}&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">perm_simp</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(supp x - as) &#8745; (p &#8729; (supp x &#8745; as)) = {}&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(supp x&#39; - as&#39;) &#8745; (p &#8729; (supp x &#8745; as)) = {}&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;p &#8729; (supp x &#8745; as) = supp x&#39; &#8745; as&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">dest</span><span class="delimiter">:</span><span class=""> </span><span class="">disjoint_right_eq</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_abs_res_stronger1_aux</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">asm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;res (op =) supp p&#39; (as&#39;, x&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;p. (as, x) &#8776;res (op =) supp p (as&#39;, x&#39;) &#8743; supp p &#8838; (supp x &#8745; as) &#8746; (supp x&#39; &#8745; as&#39;)&quot;</span><span class=""> 
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(supp x - as) &#9839;* p&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class="">  </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">#</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#39; &#8729; (supp x - as) = (supp x - as)&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">atom_set_perm_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">p</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;b &#8712; supp x. p &#8729; b = p&#39; &#8729; b&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp p &#8838; supp x &#8746; p&#39; &#8729; supp x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">set_renaming_perm2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p &#8729; x = p&#39; &#8729; x&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">supp_perm_perm_eq</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(supp x - as) &#9839;* p&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">*</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_perm</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(supp x - as) &#8745; supp p = {}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp x = (supp x - as) &#8746; (supp x &#8745; as)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp p &#8838; supp x &#8746; p&#39; &#8729; supp x&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">**</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; (supp x &#8745; as) &#8746; (p&#39; &#8729; ((supp x - as) &#8746; (supp x &#8745; as)))&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; (supp x &#8745; as) &#8746; ((p&#39; &#8729; (supp x - as)) &#8746; (p&#39; &#8729; (supp x &#8745; as)))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">union_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; (supp x &#8745; as) &#8746; (p&#39; &#8729; (supp x &#8745; as))&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">#</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; (supp x &#8745; as) &#8746; (supp x&#39; &#8745; as&#39;)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">asm</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_property_res</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp p &#8838; (supp x - as) &#8746; (supp x &#8745; as) &#8746; (supp x&#39; &#8745; as&#39;)&quot;</span><span class=""> </span><span class="keyword1">.</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> 
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp p &#8838; (supp x &#8745; as) &#8746; (supp x&#39; &#8745; as&#39;)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;res (op =) supp p (as&#39;, x&#39;)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">ultimately</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8707;p. (as, x) &#8776;res (op =) supp p (as&#39;, x&#39;) &#8743; supp p &#8838; (supp x &#8745; as) &#8746; (supp x&#39; &#8745; as&#39;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_abs_res_minimal</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">asm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;res (op =) supp p (as&#39;, x&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(as &#8745; supp x, x) &#8776;res (op =) supp p (as&#39; &#8745; supp x&#39;, x&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alpha_res</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">Diff_Int</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_abs_res_abs_set</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">asm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;res (op =) supp p (as&#39;, x&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(as &#8745; supp x, x) &#8776;set (op =) supp p (as&#39; &#8745; supp x&#39;, x&#39;)&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">c</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p &#8729; x = x&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">alpha_abs_res_minimal</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">asm</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alpha_res</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp x - as &#8745; supp x = supp (p &#8729; x) - as&#39; &#8745; supp (p &#8729; x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">alpha_abs_res_minimal</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">asm</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alpha_res</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(supp x - as &#8745; supp x) &#9839;* p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">alpha_abs_res_minimal</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">asm</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alpha_res</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p &#8729; (as &#8745; supp x) = as&#39; &#8745; supp (p &#8729; x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_commute</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">supp_property_res</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alpha_set</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_abs_set_abs_res</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">asm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(as &#8745; supp x, x) &#8776;set (op =) supp p (as&#39; &#8745; supp x&#39;, x&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;res (op =) supp p (as&#39;, x&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">Diff_Int</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_abs_res_stronger1</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">asm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;res (op =) supp p&#39; (as&#39;, x&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;p. (as, x) &#8776;res (op =) supp p (as&#39;, x&#39;) &#8743; supp p &#8838; as &#8746; as&#39;&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">alpha_abs_res_stronger1_aux</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">asm</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_abs_set_stronger1</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">asm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;set (op =) supp p&#39; (as&#39;, x&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;p. (as, x) &#8776;set (op =) supp p (as&#39;, x&#39;) &#8743; supp p &#8838; as &#8746; as&#39;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(supp x - as) &#9839;* p&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class="">  </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">#</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#39; &#8729; (supp x - as) = (supp x - as)&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">atom_set_perm_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">p</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;b &#8712; (supp x &#8746; as). p &#8729; b = p&#39; &#8729; b&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp p &#8838; (supp x &#8746; as) &#8746; p&#39; &#8729; (supp x &#8746; as)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">set_renaming_perm2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;b &#8712; supp x. p &#8729; b = p&#39; &#8729; b&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p &#8729; x = p&#39; &#8729; x&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">supp_perm_perm_eq</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;b &#8712; as. p &#8729; b = p&#39; &#8729; b&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">zb</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p &#8729; as = p&#39; &#8729; as&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_set_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;xa&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">zc</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#39; &#8729; as = as&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(supp x - as) &#9839;* p&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">*</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_perm</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(supp x - as) &#8745; supp p = {}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp x = (supp x - as) &#8746; (supp x &#8745; as)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp p &#8838; supp x &#8746; as &#8746; p&#39; &#8729; supp x &#8746; p&#39; &#8729; as&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">**</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">union_eqvt</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; (supp x &#8745; as) &#8746; as &#8746; (p&#39; &#8729; ((supp x - as) &#8746; (supp x &#8745; as))) &#8746; p&#39; &#8729; as&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; (supp x &#8745; as) &#8746; as &#8746; 
    ((p&#39; &#8729; (supp x - as)) &#8746; (p&#39; &#8729; (supp x &#8745; as))) &#8746; p&#39; &#8729; as&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">union_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; (supp x &#8745; as) &#8746; as &#8746; (p&#39; &#8729; (supp x &#8745; as)) &#8746; p&#39; &#8729; as&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">#</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; (supp x &#8745; as) &#8746; as &#8746; p&#39; &#8729; ((supp x &#8745; as) &#8746; as)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">union_eqvt</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; (supp x &#8745; as) &#8746; as &#8746; p&#39; &#8729; as&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_commute</span><span class=""> </span><span class="">Un_commute</span><span class=""> </span><span class="">sup_inf_absorb</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - as) &#8746; as &#8746; p&#39; &#8729; as&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp p &#8838; (supp x - as) &#8746; as &#8746; p&#39; &#8729; as&quot;</span><span class=""> </span><span class="keyword1">.</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp p &#8838; as &#8746; p&#39; &#8729; as&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;set (op =) supp p (as&#39;, x&#39;)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">zb</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">ultimately</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8707;p. (as, x) &#8776;set (op =) supp p (as&#39;, x&#39;) &#8743; supp p &#8838; as &#8746; as&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">zc</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_abs_lst_stronger1</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">asm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;lst (op =) supp p&#39; (as&#39;, x&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;p. (as, x) &#8776;lst (op =) supp p (as&#39;, x&#39;) &#8743; supp p &#8838; set as &#8746; set as&#39;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(supp x - set as) &#9839;* p&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class="">  </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">#</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#39; &#8729; (supp x - set as) = (supp x - set as)&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">atom_set_perm_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">p</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;b &#8712; (supp x &#8746; set as). p &#8729; b = p&#39; &#8729; b&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp p &#8838; (supp x &#8746; set as) &#8746; p&#39; &#8729; (supp x &#8746; set as)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">set_renaming_perm2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;b &#8712; supp x. p &#8729; b = p&#39; &#8729; b&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p &#8729; x = p&#39; &#8729; x&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">supp_perm_perm_eq</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;b &#8712; set as. p &#8729; b = p&#39; &#8729; b&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">zb</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p &#8729; as = p&#39; &#8729; as&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">as</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">zc</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#39; &#8729; set as = set as&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(supp x - set as) &#9839;* p&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">*</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_perm</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(supp x - set as) &#8745; supp p = {}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp x = (supp x - set as) &#8746; (supp x &#8745; set as)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp p &#8838; supp x &#8746; set as &#8746; p&#39; &#8729; supp x &#8746; p&#39; &#8729; set as&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">**</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">union_eqvt</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - set as) &#8746; (supp x &#8745; set as) &#8746; set as &#8746; 
    (p&#39; &#8729; ((supp x - set as) &#8746; (supp x &#8745; set as))) &#8746; p&#39; &#8729; set as&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - set as) &#8746; (supp x &#8745; set as) &#8746; set as &#8746; 
    ((p&#39; &#8729; (supp x - set as)) &#8746; (p&#39; &#8729; (supp x &#8745; set as))) &#8746; p&#39; &#8729; set as&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">union_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - set as) &#8746; (supp x &#8745; set as) &#8746; set as &#8746; 
    (p&#39; &#8729; (supp x &#8745; set as)) &#8746; p&#39; &#8729; set as&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">#</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - set as) &#8746; (supp x &#8745; set as) &#8746; set as &#8746; p&#39; &#8729; ((supp x &#8745; set as) &#8746; set as)&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">union_eqvt</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - set as) &#8746; (supp x &#8745; set as) &#8746; set as &#8746; p&#39; &#8729; set as&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_commute</span><span class=""> </span><span class="">Un_commute</span><span class=""> </span><span class="">sup_inf_absorb</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (supp x - set as) &#8746; set as &#8746; p&#39; &#8729; set as&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp p &#8838; (supp x - set as) &#8746; set as &#8746; p&#39; &#8729; set as&quot;</span><span class=""> </span><span class="keyword1">.</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp p &#8838; set as &#8746; p&#39; &#8729; set as&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;lst (op =) supp p (as&#39;, x&#39;)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">zb</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">ultimately</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8707;p. (as, x) &#8776;lst (op =) supp p (as&#39;, x&#39;) &#8743; supp p &#8838; set as &#8746; set as&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">zc</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alphas_abs_stronger</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(as, x) &#8776;abs_set (as&#39;, x&#39;) &#10231; (&#8707;p. (as, x) &#8776;set (op =) supp p (as&#39;, x&#39;) &#8743; supp p &#8838; as &#8746; as&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(as, x) &#8776;abs_res (as&#39;, x&#39;) &#10231; (&#8707;p. (as, x) &#8776;res (op =) supp p (as&#39;, x&#39;) &#8743; supp p &#8838; as &#8746; as&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(bs, x) &#8776;abs_lst (bs&#39;, x&#39;) &#10231; 
   (&#8707;p. (bs, x) &#8776;lst (op =) supp p (bs&#39;, x&#39;) &#8743; supp p &#8838; set bs &#8746; set bs&#39;)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">iffI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs</span><span class=""> </span><span class="">alpha_abs_set_stronger1</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">iffI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs</span><span class=""> </span><span class="">alpha_abs_res_stronger1</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">iffI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs</span><span class=""> </span><span class="">alpha_abs_lst_stronger1</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">alpha_res_alpha_set</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;(bs, x) &#8776;res op = supp p (cs, y) &#10231; (bs &#8745; supp x, x) &#8776;set op = supp p (cs &#8745; supp y, y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">alpha_abs_set_abs_res</span><span class=""> </span><span class="">alpha_abs_res_abs_set</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Quotient types *}</span><span class="">
</span><span class="">
</span><span class="keyword1">quotient_type</span><span class="">
</span><span class="">    </span><span class="tfree">&#39;a</span><span class=""> </span><span class="">abs_set</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(atom set &#215; &#39;a::pt)&quot;</span><span class=""> </span><span class="delimiter">/</span><span class=""> </span><span class="string">&quot;alpha_abs_set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">equivpI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">reflp_def</span><span class=""> </span><span class="">refl_on_def</span><span class=""> </span><span class="">symp_def</span><span class=""> </span><span class="">sym_def</span><span class=""> </span><span class="">transp_def</span><span class=""> </span><span class="">trans_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs_sym</span><span class=""> </span><span class="">alphas_abs_refl</span><span class=""> </span><span class="">alphas_abs_trans</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">quotient_type</span><span class="">
</span><span class="">    </span><span class="tfree">&#39;b</span><span class=""> </span><span class="">abs_res</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(atom set &#215; &#39;b::pt)&quot;</span><span class=""> </span><span class="delimiter">/</span><span class=""> </span><span class="string">&quot;alpha_abs_res&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">equivpI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">reflp_def</span><span class=""> </span><span class="">refl_on_def</span><span class=""> </span><span class="">symp_def</span><span class=""> </span><span class="">sym_def</span><span class=""> </span><span class="">transp_def</span><span class=""> </span><span class="">trans_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs_sym</span><span class=""> </span><span class="">alphas_abs_refl</span><span class=""> </span><span class="">alphas_abs_trans</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">quotient_type</span><span class="">
</span><span class="">   </span><span class="tfree">&#39;c</span><span class=""> </span><span class="">abs_lst</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(atom list &#215; &#39;c::pt)&quot;</span><span class=""> </span><span class="delimiter">/</span><span class=""> </span><span class="string">&quot;alpha_abs_lst&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">equivpI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">reflp_def</span><span class=""> </span><span class="">refl_on_def</span><span class=""> </span><span class="">symp_def</span><span class=""> </span><span class="">sym_def</span><span class=""> </span><span class="">transp_def</span><span class=""> </span><span class="">trans_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs_sym</span><span class=""> </span><span class="">alphas_abs_refl</span><span class=""> </span><span class="">alphas_abs_trans</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">quotient_definition</span><span class="">
</span><span class="">  </span><span class="">Abs_set</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;[_]set. _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class=""> </span><span class="">60</span><span class="delimiter">]</span><span class=""> </span><span class="">60</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;Abs_set::atom set &#8658; (&#39;a::pt) &#8658; &#39;a abs_set&quot;</span><span class="">
</span><span class="keyword2">is</span><span class="">
</span><span class="">  </span><span class="string">&quot;Pair::atom set &#8658; (&#39;a::pt) &#8658; (atom set &#215; &#39;a)&quot;</span><span class=""> </span><span class="keyword1">.</span><span class="">
</span><span class="">
</span><span class="keyword1">quotient_definition</span><span class="">
</span><span class="">  </span><span class="">Abs_res</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;[_]res. _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class=""> </span><span class="">60</span><span class="delimiter">]</span><span class=""> </span><span class="">60</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;Abs_res::atom set &#8658; (&#39;a::pt) &#8658; &#39;a abs_res&quot;</span><span class="">
</span><span class="keyword2">is</span><span class="">
</span><span class="">  </span><span class="string">&quot;Pair::atom set &#8658; (&#39;a::pt) &#8658; (atom set &#215; &#39;a)&quot;</span><span class=""> </span><span class="keyword1">.</span><span class="">
</span><span class="">
</span><span class="keyword1">quotient_definition</span><span class="">
</span><span class="">  </span><span class="">Abs_lst</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;[_]lst. _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class=""> </span><span class="">60</span><span class="delimiter">]</span><span class=""> </span><span class="">60</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;Abs_lst::atom list &#8658; (&#39;a::pt) &#8658; &#39;a abs_lst&quot;</span><span class="">
</span><span class="keyword2">is</span><span class="">
</span><span class="">  </span><span class="string">&quot;Pair::atom list &#8658; (&#39;a::pt) &#8658; (atom list &#215; &#39;a)&quot;</span><span class=""> </span><span class="keyword1">.</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_respect</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(op= ===&gt; op= ===&gt; alpha_abs_set) Pair Pair&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(op= ===&gt; op= ===&gt; alpha_abs_res) Pair Pair&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(op= ===&gt; op= ===&gt; alpha_abs_lst) Pair Pair&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">rel_fun_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs_refl</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_respect</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(op= ===&gt; alpha_abs_set ===&gt; alpha_abs_set) permute permute&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(op= ===&gt; alpha_abs_res ===&gt; alpha_abs_res) permute permute&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(op= ===&gt; alpha_abs_lst ===&gt; alpha_abs_lst) permute permute&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">rel_fun_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs_eqvt</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">Pair_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_eq_iff</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[bs]set. x = [bs&#39;]set. y &#10231; (&#8707;p. (bs, x) &#8776;set (op =) supp p (bs&#39;, y))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[bs]res. x = [bs&#39;]res. y &#10231; (&#8707;p. (bs, x) &#8776;res (op =) supp p (bs&#39;, y))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[cs]lst. x = [cs&#39;]lst. y &#10231; (&#8707;p. (cs, x) &#8776;lst (op =) supp p (cs&#39;, y))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">lifting</span><span class=""> </span><span class="">alphas_abs</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_eq_iff2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[bs]set. x = [bs&#39;]set. y &#10231; (&#8707;p. (bs, x) &#8776;set (op=) supp p (bs&#39;, y) &#8743; supp p &#8838; bs &#8746; bs&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[bs]res. x = [bs&#39;]res. y &#10231; (&#8707;p. (bs, x) &#8776;res (op=) supp p (bs&#39;, y) &#8743; supp p &#8838; bs &#8746; bs&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[cs]lst. x = [cs&#39;]lst. y &#10231; (&#8707;p. (cs, x) &#8776;lst (op=) supp p (cs&#39;, y) &#8743; supp p &#8838; set cs &#8746; set cs&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">lifting</span><span class=""> </span><span class="">alphas_abs_stronger</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_eq_res_set</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[bs]res. x = [cs]res. y &#10231; [bs &#8745; supp x]set. x = [cs &#8745; supp y]set. y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">Abs_eq_iff</span><span class=""> </span><span class="">alpha_res_alpha_set</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">rule</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_eq_res_supp</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">asm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp x &#8838; bs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[as]res. x = [as &#8745; bs]res. x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">Abs_eq_iff</span><span class=""> </span><span class="">alphas</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;0::perm&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_zero</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">asm</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_exhausts</span><span class="delimiter">[</span><span class="">cases</span><span class=""> </span><span class="">type</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(&#8896;as (x::&#39;a::pt). y1 = [as]set. x &#10233; P1) &#10233; P1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(&#8896;as (x::&#39;a::pt). y2 = [as]res. x &#10233; P2) &#10233; P2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(&#8896;bs (x::&#39;a::pt). y3 = [bs]lst. x &#10233; P3) &#10233; P3&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">lifting</span><span class=""> </span><span class="">prod.exhaust</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="tfree">&#39;a</span><span class="delimiter">=</span><span class="string">&quot;atom set&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="tfree">&#39;b</span><span class="delimiter">=</span><span class="string">&quot;&#39;a&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="">prod.exhaust</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="tfree">&#39;a</span><span class="delimiter">=</span><span class="string">&quot;atom set&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="tfree">&#39;b</span><span class="delimiter">=</span><span class="string">&quot;&#39;a&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="">prod.exhaust</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="tfree">&#39;a</span><span class="delimiter">=</span><span class="string">&quot;atom list&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="tfree">&#39;b</span><span class="delimiter">=</span><span class="string">&quot;&#39;a&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">instantiation</span><span class=""> </span><span class="">abs_set</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="delimiter">(</span><span class="">pt</span><span class="delimiter">)</span><span class=""> </span><span class="">pt</span><span class="">
</span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="keyword1">quotient_definition</span><span class="">
</span><span class="">  </span><span class="string">&quot;permute_abs_set::perm &#8658; (&#39;a::pt abs_set) &#8658; &#39;a abs_set&quot;</span><span class="">
</span><span class="keyword2">is</span><span class="">
</span><span class="">  </span><span class="string">&quot;permute:: perm &#8658; (atom set &#215; &#39;a::pt) &#8658; (atom set &#215; &#39;a::pt)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs_eqvt</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">Pair_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">permute_Abs_set</span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::pt&quot;</span><span class="">  
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(p &#8729; ([as]set. x)) = [p &#8729; as]set. (p &#8729; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">lifting</span><span class=""> </span><span class="">permute_prod.simps</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="tfree">&#39;a</span><span class="delimiter">=</span><span class="string">&quot;atom set&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="tfree">&#39;b</span><span class="delimiter">=</span><span class="string">&quot;&#39;a&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">instance</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">standard</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword2">end</span><span class="">
</span><span class="">
</span><span class="keyword1">instantiation</span><span class=""> </span><span class="">abs_res</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="delimiter">(</span><span class="">pt</span><span class="delimiter">)</span><span class=""> </span><span class="">pt</span><span class="">
</span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="keyword1">quotient_definition</span><span class="">
</span><span class="">  </span><span class="string">&quot;permute_abs_res::perm &#8658; (&#39;a::pt abs_res) &#8658; &#39;a abs_res&quot;</span><span class="">
</span><span class="keyword2">is</span><span class="">
</span><span class="">  </span><span class="string">&quot;permute:: perm &#8658; (atom set &#215; &#39;a::pt) &#8658; (atom set &#215; &#39;a::pt)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs_eqvt</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">Pair_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">permute_Abs_res</span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::pt&quot;</span><span class="">  
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(p &#8729; ([as]res. x)) = [p &#8729; as]res. (p &#8729; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">lifting</span><span class=""> </span><span class="">permute_prod.simps</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="tfree">&#39;a</span><span class="delimiter">=</span><span class="string">&quot;atom set&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="tfree">&#39;b</span><span class="delimiter">=</span><span class="string">&quot;&#39;a&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">instance</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">standard</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword2">end</span><span class="">
</span><span class="">
</span><span class="keyword1">instantiation</span><span class=""> </span><span class="">abs_lst</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="delimiter">(</span><span class="">pt</span><span class="delimiter">)</span><span class=""> </span><span class="">pt</span><span class="">
</span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="keyword1">quotient_definition</span><span class="">
</span><span class="">  </span><span class="string">&quot;permute_abs_lst::perm &#8658; (&#39;a::pt abs_lst) &#8658; &#39;a abs_lst&quot;</span><span class="">
</span><span class="keyword2">is</span><span class="">
</span><span class="">  </span><span class="string">&quot;permute:: perm &#8658; (atom list &#215; &#39;a::pt) &#8658; (atom list &#215; &#39;a::pt)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas_abs_eqvt</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">Pair_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">permute_Abs_lst</span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::pt&quot;</span><span class="">  
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(p &#8729; ([as]lst. x)) = [p &#8729; as]lst. (p &#8729; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">lifting</span><span class=""> </span><span class="">permute_prod.simps</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="tfree">&#39;a</span><span class="delimiter">=</span><span class="string">&quot;atom list&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="tfree">&#39;b</span><span class="delimiter">=</span><span class="string">&quot;&#39;a&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">instance</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">standard</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword2">end</span><span class="">
</span><span class="">
</span><span class="keyword1">lemmas</span><span class=""> </span><span class="">permute_Abs</span><span class="delimiter">[</span><span class="">eqvt</span><span class="delimiter">]</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">permute_Abs_set</span><span class=""> </span><span class="">permute_Abs_res</span><span class=""> </span><span class="">permute_Abs_lst</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_swap1</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &#8713; (supp x) - bs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;b &#8713; (supp x) - bs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[bs]set. x = [(a &#8652; b) &#8729; bs]set. ((a &#8652; b) &#8729; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[bs]res. x = [(a &#8652; b) &#8729; bs]res. ((a &#8652; b) &#8729; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">Abs_eq_iff</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">supp_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> </span><span class="">Diff_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_def</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">swap_set_not_in</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class="delimiter">]</span><span class=""> 
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(a &#8652; b)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_perm</span><span class=""> </span><span class="">swap_atom</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_swap2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &#8713; (supp x) - (set bs)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;b &#8713; (supp x) - (set bs)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[bs]lst. x = [(a &#8652; b) &#8729; bs]lst. ((a &#8652; b) &#8729; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">Abs_eq_iff</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">alphas</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">supp_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> </span><span class="">Diff_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_def</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">swap_set_not_in</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(a &#8652; b)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_perm</span><span class=""> </span><span class="">swap_atom</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_supports</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;((supp x) - as) supports ([as]set. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;((supp x) - as) supports ([as]res. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;((supp x) - set bs) supports ([bs]lst. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">supports_def</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">permute_Abs</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_swap1</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> </span><span class="">Abs_swap2</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">function</span><span class="">
</span><span class="">  </span><span class="">supp_set</span><span class="">  </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;a::pt) abs_set &#8658; atom set&quot;</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">  </span><span class="">supp_res</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;a::pt) abs_res &#8658; atom set&quot;</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">  </span><span class="">supp_lst</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;a::pt) abs_lst &#8658; atom set&quot;</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;supp_set ([as]set. x) = supp x - as&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;supp_res ([as]res. x) = supp x - as&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;supp_lst (Abs_lst cs x) = (supp x) - (set cs)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_eq_iff</span><span class=""> </span><span class="">alphas_abs</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">ba</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">termination</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">lexicographic_order</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">supp_funs_eqvt</span><span class="delimiter">[</span><span class="">eqvt</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(p &#8729; supp_set x) = supp_set (p &#8729; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(p &#8729; supp_res y) = supp_res (p &#8729; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(p &#8729; supp_lst z) = supp_lst (p &#8729; z)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">z</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_fresh_aux</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;a &#9839; [bs]set. x &#10233; a &#9839; supp_set ([bs]set. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;a &#9839; [bs]res. x &#10233; a &#9839; supp_res ([bs]res. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;a &#9839; [cs]lst. x &#10233; a &#9839; supp_lst ([cs]lst. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">fresh_fun_eqvt_app</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">eqvt_def</span><span class=""> </span><span class="">eqvts_raw</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_supp_subset1</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite (supp x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(supp x) - as &#8838; supp ([as]set. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(supp x) - as &#8838; supp ([as]res. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;(supp x) - (set bs) &#8838; supp ([bs]lst. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">supp_conv_fresh</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_aux</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_def</span><span class=""> </span><span class="">supp_finite_atom_set</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_supp_subset2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite (supp x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;supp ([as]set. x) &#8838; (supp x) - as&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;supp ([as]res. x) &#8838; (supp x) - as&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;supp ([bs]lst. x) &#8838; (supp x) - (set bs)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">!</span><span class="delimiter">]</span><span class=""> </span><span class="">supp_is_subset</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_supports</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_finite_supp</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite (supp x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;supp ([as]set. x) = (supp x) - as&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;supp ([as]res. x) = (supp x) - as&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;supp ([bs]lst. x) = (supp x) - (set bs)&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">Abs_supp_subset1</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class=""> </span><span class="">Abs_supp_subset2</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="delimiter">+</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">supp_Abs</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;supp ([as]set. x) = (supp x) - as&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;supp ([as]res. x) = (supp x) - as&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;supp ([bs]lst. x) = (supp x) - (set bs)&quot;</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_finite_supp</span><span class=""> </span><span class="">finite_supp</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">instance</span><span class=""> </span><span class="">abs_set</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="delimiter">(</span><span class="">fs</span><span class="delimiter">)</span><span class=""> </span><span class="">fs</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">standard</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_Abs</span><span class=""> </span><span class="">finite_supp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">instance</span><span class=""> </span><span class="">abs_res</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="delimiter">(</span><span class="">fs</span><span class="delimiter">)</span><span class=""> </span><span class="">fs</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">standard</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_Abs</span><span class=""> </span><span class="">finite_supp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">instance</span><span class=""> </span><span class="">abs_lst</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="delimiter">(</span><span class="">fs</span><span class="delimiter">)</span><span class=""> </span><span class="">fs</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">standard</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_Abs</span><span class=""> </span><span class="">finite_supp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;a &#9839; [bs]set. x &#10231; a &#8712; bs &#8744; (a &#8713; bs &#8743; a &#9839; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;a &#9839; [bs]res. x &#10231; a &#8712; bs &#8744; (a &#8713; bs &#8743; a &#9839; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;a &#9839; [cs]lst. x &#10231; a &#8712; (set cs) &#8744; (a &#8713; (set cs) &#8743; a &#9839; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_def</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">supp_Abs</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_fresh_star_iff</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;as &#9839;* ([bs]set. x) &#10231; (as - bs) &#9839;* x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;as &#9839;* ([bs]res. x) &#10231; (as - bs) &#9839;* x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;as &#9839;* ([cs]lst. x) &#10231; (as - set cs) &#9839;* x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_fresh_star</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;as &#8838; as&#39; &#10233; as &#9839;* ([as&#39;]set. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;as &#8838; as&#39; &#10233; as &#9839;* ([as&#39;]res. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;bs &#8838; set bs&#39; &#10233; bs &#9839;* ([bs&#39;]lst. x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_fresh_star2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;as &#8745; bs = {} &#10233; as &#9839;* ([bs]set. x) &#10231; as &#9839;* x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;as &#8745; bs = {} &#10233; as &#9839;* ([bs]res. x) &#10231; as &#9839;* x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;cs &#8745; set ds = {} &#10233; cs &#9839;* ([ds]lst. x) &#10231; cs &#9839;* x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Abstractions of single atoms *}</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs1_eq</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom a}]set. y &#10231; x = y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[{atom a}]res. x = [{atom a}]res. y &#10231; x = y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[[atom a]]lst. x = [[atom a]]lst. y &#10231; x = y&quot;</span><span class="">
</span><span class="keyword1">unfolding</span><span class=""> </span><span class="">Abs_eq_iff2</span><span class=""> </span><span class="">alphas</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_perm_singleton</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_zero_perm</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs1_eq_iff_fresh</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">c</span><span class="delimiter">::</span><span class="string">&quot;&#39;b::at&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;atom c &#9839; (a, b, x, y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom b}]set. y &#10231; (a &#8596; c) &#8729; x = (b &#8596; c) &#8729; y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[{atom a}]res. x = [{atom b}]res. y &#10231; (a &#8596; c) &#8729; x = (b &#8596; c) &#8729; y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[[atom a]]lst. x = [[atom b]]lst. y &#10231; (a &#8596; c) &#8729; x = (b &#8596; c) &#8729; y&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = (a &#8596; c) &#8729; ([{atom a}]set. x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom c}]set. ((a &#8596; c) &#8729; x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom b}]set. y = (b &#8596; c) &#8729; ([{atom b}]set. y)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom b}]set. y = [{atom c}]set. ((b &#8596; c) &#8729; y)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">ultimately</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom b}]set. y &#10231; (a &#8596; c) &#8729; x = (b &#8596; c) &#8729; y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom a}]res. x = (a &#8596; c) &#8729; ([{atom a}]res. x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom a}]res. x = [{atom c}]res. ((a &#8596; c) &#8729; x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom b}]res. y = (b &#8596; c) &#8729; ([{atom b}]res. y)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom b}]res. y = [{atom c}]res. ((b &#8596; c) &#8729; y)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">ultimately</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;[{atom a}]res. x = [{atom b}]res. y &#10231; (a &#8596; c) &#8729; x = (b &#8596; c) &#8729; y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[[atom a]]lst. x = (a &#8596; c) &#8729; ([[atom a]]lst. x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[[atom a]]lst. x = [[atom c]]lst. ((a &#8596; c) &#8729; x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[[atom b]]lst. y = (b &#8596; c) &#8729; ([[atom b]]lst. y)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[[atom b]]lst. y = [[atom c]]lst. ((b &#8596; c) &#8729; y)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">ultimately</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;[[atom a]]lst. x = [[atom b]]lst. y &#10231; (a &#8596; c) &#8729; x = (b &#8596; c) &#8729; y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs1_eq_iff_all</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">z</span><span class="delimiter">::</span><span class="string">&quot;&#39;c::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="delimiter">::</span><span class="string">&quot;&#39;b::at&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom b}]set. y &#10231; (&#8704;c. atom c &#9839; z &#10230; atom c &#9839; (a, b, x, y) &#10230; (a &#8596; c) &#8729; x = (b &#8596; c) &#8729; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[{atom a}]res. x = [{atom b}]res. y &#10231; (&#8704;c. atom c &#9839; z &#10230; atom c &#9839; (a, b, x, y) &#10230; (a &#8596; c) &#8729; x = (b &#8596; c) &#8729; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[[atom a]]lst. x = [[atom b]]lst. y &#10231; (&#8704;c. atom c &#9839; z &#10230; atom c &#9839; (a, b, x, y) &#10230; (a &#8596; c) &#8729; x = (b &#8596; c) &#8729; y)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class="delimiter">)</span><span class=""> 
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq_iff_fresh</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="tvar">?&#39;a</span><span class="delimiter">=</span><span class="string">&quot;&#39;b::at&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(a, b, x, y, z)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">obtain_fresh</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;aa&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">spec</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">Abs1_eq_iff_fresh</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_Pair</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">2</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq_iff_fresh</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="tvar">?&#39;a</span><span class="delimiter">=</span><span class="string">&quot;&#39;b::at&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(a, b, x, y, z)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">obtain_fresh</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;aa&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">spec</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">Abs1_eq_iff_fresh</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_Pair</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">2</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq_iff_fresh</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="tvar">?&#39;a</span><span class="delimiter">=</span><span class="string">&quot;&#39;b::at&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(a, b, x, y, z)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">obtain_fresh</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;aa&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">spec</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">Abs1_eq_iff_fresh</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_Pair</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="">2</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs1_eq_iff</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="delimiter">::</span><span class="string">&quot;&#39;b::at&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom b}]set. y &#10231; (a = b &#8743; x = y) &#8744; (a &#8800; b &#8743; x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[{atom a}]res. x = [{atom b}]res. y &#10231; (a = b &#8743; x = y) &#8744; (a &#8800; b &#8743; x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[[atom a]]lst. x = [[atom b]]lst. y &#10231; (a = b &#8743; x = y) &#8744; (a &#8800; b &#8743; x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y)&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="string">&quot;a = b&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom b}]set. y &#10231; (a = b &#8743; x = y)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &#8800; b&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom b}]set. y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="">#</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;atom a &#9839; [{atom b}]set. y&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">**</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom a}]set. ((a &#8596; b) &#8729; y) = (a &#8596; b) &#8729; ([{atom b}]set. y)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = [{atom b}]set. y&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">#</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = [{atom a}]set. x&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">**</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;a &#8800; b &#8743; x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">#</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &#8800; b&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom a}]set. ((a &#8596; b) &#8729; y)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">**</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (a &#8596; b) &#8729; ([{atom b}]set. y)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_set_def</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = [{atom b}]set. y&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class=""> </span><span class="">**</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom b}]set. y&quot;</span><span class=""> </span><span class="keyword1">.</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">ultimately</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom b}]set. y &#10231; (a = b &#8743; x = y) &#8744; (a &#8800; b &#8743; x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="string">&quot;a = b&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Abs_res {atom a} x = Abs_res {atom b} y &#10231; (a = b &#8743; x = y)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &#8800; b&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Abs_res {atom a} x = Abs_res {atom b} y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="">#</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;atom a &#9839; Abs_res {atom b} y&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">**</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Abs_res {atom a} ((a &#8596; b) &#8729; y) = (a &#8596; b) &#8729; (Abs_res {atom b} y)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = Abs_res {atom b} y&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">#</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = Abs_res {atom a} x&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">**</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;a &#8800; b &#8743; x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">#</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &#8800; b&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Abs_res {atom a} x = Abs_res {atom a} ((a &#8596; b) &#8729; y)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">**</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (a &#8596; b) &#8729; Abs_res {atom b} y&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_set_def</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = Abs_res {atom b} y&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class=""> </span><span class="">**</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Abs_res {atom a} x = Abs_res {atom b} y&quot;</span><span class=""> </span><span class="keyword1">.</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">ultimately</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;Abs_res {atom a} x = Abs_res {atom b} y &#10231; (a = b &#8743; x = y) &#8744; (a &#8800; b &#8743; x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="string">&quot;a = b&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Abs_lst [atom a] x = Abs_lst [atom b] y &#10231; (a = b &#8743; x = y)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &#8800; b&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Abs_lst [atom a] x = Abs_lst [atom b] y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="">#</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;atom a &#9839; Abs_lst [atom b] y&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">**</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Abs_lst [atom a] ((a &#8596; b) &#8729; y) = (a &#8596; b) &#8729; (Abs_lst [atom b] y)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = Abs_lst [atom b] y&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">#</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = Abs_lst [atom a] x&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">**</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;a &#8800; b &#8743; x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">#</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">moreover</span><span class=""> 
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &#8800; b&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Abs_lst [atom a] x = Abs_lst [atom a] ((a &#8596; b) &#8729; y)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">**</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = (a &#8596; b) &#8729; Abs_lst [atom b] y&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">assms</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = Abs_lst [atom b] y&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class=""> </span><span class="">**</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Abs_lst [atom a] x = Abs_lst [atom b] y&quot;</span><span class=""> </span><span class="keyword1">.</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">ultimately</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;Abs_lst [atom a] x = Abs_lst [atom b] y &#10231; (a = b &#8743; x = y) &#8744; (a &#8800; b &#8743; x = (a &#8596; b) &#8729; y &#8743; atom a &#9839; y)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs1_eq_iff&#39;</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="delimiter">::</span><span class="string">&quot;&#39;b::at&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;[{atom a}]set. x = [{atom b}]set. y &#10231; (a = b &#8743; x = y) &#8744; (a &#8800; b &#8743; (b &#8596; a) &#8729; x = y &#8743; atom b &#9839; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[{atom a}]res. x = [{atom b}]res. y &#10231; (a = b &#8743; x = y) &#8744; (a &#8800; b &#8743; (b &#8596; a) &#8729; x = y &#8743; atom b &#9839; x)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">   </span><span class="string">&quot;[[atom a]]lst. x = [[atom b]]lst. y &#10231; (a = b &#8743; x = y) &#8744; (a &#8800; b &#8743; (b &#8596; a) &#8729; x = y &#8743; atom b &#9839; x)&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq_iff</span><span class=""> </span><span class="">fresh_permute_left</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">ML</span><span class=""> </span><span class="verbatim">{*
fun alpha_single_simproc thm _ ctxt ctrm =
  let
    val thy = Proof_Context.theory_of ctxt
    val _ $ (_ $ x) $ (_ $ y) = Thm.term_of ctrm
    val cvrs = union (op =) (Term.add_frees x []) (Term.add_frees y [])
      |&gt; filter (fn (_, ty) =&gt; Sign.of_sort thy (ty, @{sort fs}))
      |&gt; map Free
      |&gt; HOLogic.mk_tuple
      |&gt; Thm.cterm_of ctxt
    val cvrs_ty = Thm.ctyp_of_cterm cvrs
    val thm&#39; = thm
      |&gt; Thm.instantiate&#39; [NONE, NONE, SOME cvrs_ty] [NONE, NONE, NONE, NONE, SOME cvrs] 
  in
    SOME thm&#39;
  end
*}</span><span class="">
</span><span class="">
</span><span class="keyword1">simproc_setup</span><span class=""> </span><span class="">alpha_set</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;[{atom a}]set. x = [{atom b}]set. y&quot;</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">=</span><span class=""> 
</span><span class="">  </span><span class="verbatim">{* alpha_single_simproc @{thm Abs1_eq_iff_all(1)[THEN eq_reflection]} *}</span><span class="">
</span><span class="">
</span><span class="keyword1">simproc_setup</span><span class=""> </span><span class="">alpha_res</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;[{atom a}]res. x = [{atom b}]res. y&quot;</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">=</span><span class=""> 
</span><span class="">  </span><span class="verbatim">{* alpha_single_simproc @{thm Abs1_eq_iff_all(2)[THEN eq_reflection]} *}</span><span class="">
</span><span class="">
</span><span class="keyword1">simproc_setup</span><span class=""> </span><span class="">alpha_lst</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;[[atom a]]lst. x = [[atom b]]lst. y&quot;</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">=</span><span class=""> 
</span><span class="">  </span><span class="verbatim">{* alpha_single_simproc @{thm Abs1_eq_iff_all(3)[THEN eq_reflection]} *}</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Renaming of bodies of abstractions *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_rename_set</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(p &#8729; bs) &#9839;* x&quot;</span><span class=""> 
</span><span class="">  </span><span class="comment">(*and     b: &quot;finite bs&quot;*)</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;q. [bs]set. x = [p &#8729; bs]set. (q &#8729; x) &#8743; q &#8729; bs = p &#8729; bs&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">set_renaming_perm2</span><span class=""> 
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">q</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;b &#8712; bs. q &#8729; b = p &#8729; b&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp q &#8838; bs &#8746; (p &#8729; bs)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">***</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; bs = p &#8729; bs&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">*</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">permute_set_eq_image</span><span class=""> </span><span class="">image_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[bs]set. x =  q &#8729; ([bs]set. x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">**</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">Abs_fresh_star_iff</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = [q &#8729; bs]set. (q &#8729; x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[bs]set. x = [p &#8729; bs]set. (q &#8729; x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">***</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8707;q. [bs]set. x = [p &#8729; bs]set. (q &#8729; x) &#8743; q &#8729; bs = p &#8729; bs&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">***</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_rename_res</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(p &#8729; bs) &#9839;* x&quot;</span><span class=""> 
</span><span class="">  </span><span class="comment">(*and     b: &quot;finite bs&quot;*)</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;q. [bs]res. x = [p &#8729; bs]res. (q &#8729; x) &#8743; q &#8729; bs = p &#8729; bs&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">set_renaming_perm2</span><span class=""> 
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">q</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;b &#8712; bs. q &#8729; b = p &#8729; b&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp q &#8838; bs &#8746; (p &#8729; bs)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">***</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; bs = p &#8729; bs&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">*</span><span class=""> 
</span><span class="">    </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">permute_set_eq_image</span><span class=""> </span><span class="">image_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[bs]res. x =  q &#8729; ([bs]res. x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">**</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">Abs_fresh_star_iff</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = [q &#8729; bs]res. (q &#8729; x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[bs]res. x = [p &#8729; bs]res. (q &#8729; x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">***</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8707;q. [bs]res. x = [p &#8729; bs]res. (q &#8729; x) &#8743; q &#8729; bs = p &#8729; bs&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">***</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_rename_lst</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(p &#8729; (set bs)) &#9839;* x&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;q. [bs]lst. x = [p &#8729; bs]lst. (q &#8729; x) &#8743; q &#8729; bs = p &#8729; bs&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">list_renaming_perm</span><span class=""> 
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">q</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">*</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;b &#8712; set bs. q &#8729; b = p &#8729; b&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">**</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp q &#8838; set bs &#8746; (p &#8729; set bs)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">***</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; bs = p &#8729; bs&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">*</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">bs</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">insert_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[bs]lst. x =  q &#8729; ([bs]lst. x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">**</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">Abs_fresh_star_iff</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">fresh_star_def</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = [q &#8729; bs]lst. (q &#8729; x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[bs]lst. x = [p &#8729; bs]lst. (q &#8729; x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">***</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8707;q. [bs]lst. x = [p &#8729; bs]lst. (q &#8729; x) &#8743; q &#8729; bs = p &#8729; bs&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">***</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">text</span><span class=""> </span><span class="verbatim">{* for deep recursive binders *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_rename_set&#39;</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(p &#8729; bs) &#9839;* x&quot;</span><span class=""> 
</span><span class="">  </span><span class="comment">(*and     b: &quot;finite bs&quot;*)</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;q. [bs]set. x = [q &#8729; bs]set. (q &#8729; x) &#8743; q &#8729; bs = p &#8729; bs&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">Abs_rename_set</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_rename_res&#39;</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(p &#8729; bs) &#9839;* x&quot;</span><span class=""> 
</span><span class="">  </span><span class="comment">(*and     b: &quot;finite bs&quot;*)</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;q. [bs]res. x = [q &#8729; bs]res. (q &#8729; x) &#8743; q &#8729; bs = p &#8729; bs&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">Abs_rename_res</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_rename_lst&#39;</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="string">&quot;&#39;a::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(p &#8729; (set bs)) &#9839;* x&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;q. [bs]lst. x = [q &#8729; bs]lst. (q &#8729; x) &#8743; q &#8729; bs = p &#8729; bs&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">Abs_rename_lst</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">a</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Infrastructure for building tuples of relations and functions *}</span><span class="">
</span><span class="">
</span><span class="keyword1">fun</span><span class="">
</span><span class="">  </span><span class="">prod_fv</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;a &#8658; atom set) &#8658; (&#39;b &#8658; atom set) &#8658; (&#39;a &#215; &#39;b) &#8658; atom set&quot;</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;prod_fv fv1 fv2 (x, y) = fv1 x &#8746; fv2 y&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> 
</span><span class="">  </span><span class="">prod_alpha</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;a &#8658; &#39;a &#8658; bool) &#8658; (&#39;b &#8658; &#39;b &#8658; bool) &#8658; (&#39;a &#215; &#39;b &#8658; &#39;a &#215; &#39;b &#8658; bool)&quot;</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class=""> </span><span class="string">&quot;prod_alpha = rel_prod&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_respect</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;((R1 ===&gt; op =) ===&gt; (R2 ===&gt; op =) ===&gt; rel_prod R1 R2 ===&gt; op =) prod_fv prod_fv&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">rel_fun_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">quot_preserve</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">q1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R1 abs1 rep1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class="">     </span><span class="">q2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Quotient3 R2 abs2 rep2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;((abs1 ---&gt; id) ---&gt; (abs2 ---&gt; id) ---&gt; map_prod rep1 rep2 ---&gt; id) prod_fv = prod_fv&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fun_eq_iff</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">q1</span><span class="delimiter">]</span><span class=""> </span><span class="">Quotient3_abs_rep</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">q2</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">mono</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;A &lt;= B &#10233; C &lt;= D ==&gt; prod_alpha A C &lt;= prod_alpha B D&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">prod_alpha_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">eqvt</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;p &#8729; prod_alpha A B x y = prod_alpha (p &#8729; A) (p &#8729; B) (p &#8729; x) (p &#8729; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">prod_alpha_def</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">rel_prod_conv</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">perm_simp</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">refl</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">eqvt</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;p &#8729; prod_fv A B (x, y) = prod_fv (p &#8729; A) (p &#8729; B) (p &#8729; x, p &#8729; y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">prod_fv.simps</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">perm_simp</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">refl</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">prod_fv_supp</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;prod_fv supp supp = supp&quot;</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">ext</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">prod_alpha_eq</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;prod_alpha (op=) (op=) = (op=)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">prod_alpha_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span class=""> </span><span class="">ext</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword2">end</span><span class="">
</span></pre>

</div>
</body>
</html>
