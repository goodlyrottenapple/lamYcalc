<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory Nominal2_FCB (Isabelle2016: February 2016)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory Nominal2_FCB</h1>

<span class="command">theory</span> <span class="name">Nominal2_FCB</span><br/>
<span class="keyword">imports</span> <a href="Nominal2_Abs.html"><span class="name">Nominal2_Abs</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1">theory</span><span class=""> </span><span class="">Nominal2_FCB</span><span class="">
</span><span class="keyword2">imports</span><span class=""> </span><span class="string">&quot;Nominal2_Abs&quot;</span><span class=""> 
</span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">text</span><span class=""> </span><span class="verbatim">{*
  A tactic which solves all trivial cases in function 
  definitions, and leaves the others unchanged.
*}</span><span class="">
</span><span class="">
</span><span class="keyword1">ML</span><span class=""> </span><span class="verbatim">{*
val all_trivials : (Proof.context -&gt; Proof.method) context_parser =
Scan.succeed (fn ctxt =&gt;
 let
   val tac = TRYALL (SOLVED&#39; (full_simp_tac ctxt))
 in 
   Method.SIMPLE_METHOD&#39; (K tac)
 end)
*}</span><span class="">
</span><span class="">
</span><span class="keyword1">method_setup</span><span class=""> </span><span class="">all_trivials</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="verbatim">{* all_trivials *}</span><span class=""> </span><span class="verbatim">{* solves trivial goals *}</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_lst1_fcb</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;a :: at&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">S</span><span class=""> </span><span class="">T</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;b :: fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[[atom x]]lst. T = [[atom y]]lst. S&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;x &#8800; y; atom y &#9839; T; atom x &#9839; (y &#8596; x) &#8729; T&#10215; &#10233; atom x &#9839; f x T&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;x &#8800; y; atom y &#9839; T; atom x &#9839; (y &#8596; x) &#8729; T&#10215; &#10233; atom y &#9839; f x T&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">p</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;S = (x &#8596; y) &#8729; T; x &#8800; y; atom y &#9839; T; atom x &#9839; S&#10215; 
    &#10233; (x &#8596; y) &#8729; (f x T) = f y S&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;f x T = f y S&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">e</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;atom x &#9839; S&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq_iff&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">elim</span><span class=""> </span><span class="">conjE</span><span class=""> </span><span class="">disjE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trans</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;(x &#8596; y)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">supp_perm_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">fresh_star_supp_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">flip_def</span><span class=""> </span><span class="">supp_swap</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">flip_commute</span><span class=""> </span><span class="">p</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs1_eq_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_lst_fcb</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">ys</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;a :: fs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">S</span><span class=""> </span><span class="">T</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;b :: fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Abs_lst (ba xs) T) = (Abs_lst (ba ys) S)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8712; set (ba xs) &#10233; x &#9839; f xs T&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x. &#10214;supp T - set (ba xs) = supp S - set (ba ys); x &#8712; set (ba ys)&#10215; &#10233; x &#9839; f xs T&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">eqv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. &#10214;p &#8729; T = S; p &#8729; ba xs = ba ys; supp p &#8838; set (ba xs) &#8746; set (ba ys)&#10215; 
      &#10233; p &#8729; (f xs T) = f ys S&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;f xs T = f ys S&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">asm</span><span class="delimiter">)</span><span class=""> </span><span class="">Abs_eq_iff2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">elim</span><span class=""> </span><span class="">exE</span><span class=""> </span><span class="">conjE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trans</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;p&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">supp_perm_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">fresh_star_supp_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">fresh_star_perm_set_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">finite_Diff</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">finite_supp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(set (ba xs) &#8746; set (ba ys)) &#9839;* f xs T&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Un_absorb2</span><span class=""> </span><span class="">fresh_star_Un</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">fresh_star_Un</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">f1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">f2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_set_fcb</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">ys</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;a :: fs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">S</span><span class=""> </span><span class="">T</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;b :: fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Abs_set (ba xs) T) = (Abs_set (ba ys) S)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8712; ba xs &#10233; x &#9839; f xs T&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x. &#10214;supp T - ba xs = supp S - ba ys; x &#8712; ba ys&#10215; &#10233; x &#9839; f xs T&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">eqv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. &#10214;p &#8729; T = S; p &#8729; ba xs = ba ys; supp p &#8838; ba xs &#8746; ba ys&#10215; &#10233; p &#8729; (f xs T) = f ys S&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;f xs T = f ys S&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">asm</span><span class="delimiter">)</span><span class=""> </span><span class="">Abs_eq_iff2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">elim</span><span class=""> </span><span class="">exE</span><span class=""> </span><span class="">conjE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trans</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;p&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">supp_perm_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">fresh_star_supp_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">fresh_star_perm_set_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">finite_Diff</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">finite_supp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(ba xs &#8746; ba ys) &#9839;* f xs T&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Un_absorb2</span><span class=""> </span><span class="">fresh_star_Un</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">fresh_star_Un</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">f1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">f2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_res_fcb</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">ys</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;a :: at_base) set&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">S</span><span class=""> </span><span class="">T</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;b :: fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Abs_res (atom ` xs) T) = (Abs_res (atom ` ys) S)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x. x &#8712; atom ` xs &#10233; x &#8712; supp T &#10233; x &#9839; f xs T&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;x. &#10214;supp T - atom ` xs = supp S - atom ` ys; x &#8712; atom ` ys; x &#8712; supp S&#10215; &#10233; x &#9839; f xs T&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">eqv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. &#10214;p &#8729; T = S; supp p &#8838; atom ` xs &#8745; supp T &#8746; atom ` ys &#8745; supp S;
      p &#8729; (atom ` xs &#8745; supp T) = atom ` ys &#8745; supp S&#10215; &#10233; p &#8729; (f xs T) = f ys S&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;f xs T = f ys S&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">asm</span><span class="delimiter">)</span><span class=""> </span><span class="">Abs_eq_res_set</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">asm</span><span class="delimiter">)</span><span class=""> </span><span class="">Abs_eq_iff2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">elim</span><span class=""> </span><span class="">exE</span><span class=""> </span><span class="">conjE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">trans</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="string">&quot;p&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">supp_perm_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">fresh_star_supp_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">fresh_star_perm_set_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">finite_Diff</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">finite_supp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(atom ` xs &#8745; supp T &#8746; atom ` ys &#8745; supp S) &#9839;* f xs T&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Un_absorb2</span><span class=""> </span><span class="">fresh_star_Un</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">fresh_star_Un</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">f1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;supp T - atom ` xs = supp S - atom ` ys&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">f2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">blast</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_set_fcb2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">as</span><span class=""> </span><span class="">bs</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;atom set&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;b :: fs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">c</span><span class="delimiter">::</span><span class="string">&quot;&#39;c::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">eq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[as]set. x = [bs]set. y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fin</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite as&quot;</span><span class=""> </span><span class="string">&quot;finite bs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fcb1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;as &#9839;* f as x c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fresh1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;as &#9839;* c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fresh2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;bs &#9839;* c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">perm1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. supp p &#9839;* c &#10233; p &#8729; (f as x c) = f (p &#8729; as) (p &#8729; x) c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">perm2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. supp p &#9839;* c &#10233; p &#8729; (f bs y c) = f (p &#8729; bs) (p &#8729; y) c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;f as x c = f bs y c&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp (as, x, c) supports (f as x c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class="">  </span><span class="">supports_def</span><span class=""> </span><span class="">fresh_def</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">perm1</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">supp_swap</span><span class=""> </span><span class="">swap_fresh_fresh</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">fin1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite (supp (f as x c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">fin</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">supports_finite</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">finite_supp</span><span class=""> </span><span class="">supp_of_finite_sets</span><span class=""> </span><span class="">supp_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp (bs, y, c) supports (f bs y c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class="">  </span><span class="">supports_def</span><span class=""> </span><span class="">fresh_def</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">perm2</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">supp_swap</span><span class=""> </span><span class="">swap_fresh_fresh</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">fin2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite (supp (f bs y c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">fin</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">supports_finite</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">finite_supp</span><span class=""> </span><span class="">supp_of_finite_sets</span><span class=""> </span><span class="">supp_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">q</span><span class="delimiter">::</span><span class="string">&quot;perm&quot;</span><span class=""> </span><span class="keyword2">where</span><span class=""> 
</span><span class="">    </span><span class="">fr1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(q &#8729; as) &#9839;* (x, c, f as x c, f bs y c)&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">fr2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp q &#9839;* ([as]set. x)&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">inc</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp q &#8838; as &#8746; (q &#8729; as)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">at_set_avoiding3</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">xs</span><span class="delimiter">=</span><span class="string">&quot;as&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;(x, c, f as x c, f bs y c)&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;[as]set. x&quot;</span><span class="delimiter">]</span><span class="">  
</span><span class="">      </span><span class="">fin1</span><span class=""> </span><span class="">fin2</span><span class=""> </span><span class="">fin</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_Pair</span><span class=""> </span><span class="">finite_supp</span><span class=""> </span><span class="">Abs_fresh_star</span><span class=""> </span><span class="">dest</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_supp_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[q &#8729; as]set. (q &#8729; x) = q &#8729; ([as]set. x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = [as]set. x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fr2</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[q &#8729; as]set. (q &#8729; x) = [bs]set. y&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eq</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">r</span><span class="delimiter">::</span><span class="">perm</span><span class=""> </span><span class="keyword2">where</span><span class=""> 
</span><span class="">    </span><span class="">qq1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; x = r &#8729; y&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">qq2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; as = r &#8729; bs&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">qq3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp r &#8838; (q &#8729; as) &#8746; bs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">sym</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_eq_iff2</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">exE</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">conjE</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;p&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">meta_spec</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">blast</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;as &#9839;* f as x c&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">fcb1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;q &#8729; (as &#9839;* f as x c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_bool_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(q &#8729; as) &#9839;* f (q &#8729; as) (q &#8729; x) c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_eqvt</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">asm</span><span class="delimiter">)</span><span class=""> </span><span class="">perm1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">inc</span><span class=""> </span><span class="">fresh1</span><span class=""> </span><span class="">fr1</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(r &#8729; bs) &#9839;* f (r &#8729; bs) (r &#8729; y) c&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">qq1</span><span class=""> </span><span class="">qq2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;r &#8729; (bs &#9839;* f bs y c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_eqvt</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">asm</span><span class="delimiter">)</span><span class=""> </span><span class="">perm2</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">qq3</span><span class=""> </span><span class="">fresh2</span><span class=""> </span><span class="">fr1</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">set_eqvt</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">fcb2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;bs &#9839;* f bs y c&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_bool_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;f as x c = q &#8729; (f as x c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">inc</span><span class=""> </span><span class="">fcb1</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = f (q &#8729; as) (q &#8729; x) c&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">inc</span><span class=""> </span><span class="">fresh1</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = f (r &#8729; bs) (r &#8729; y) c&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">qq1</span><span class=""> </span><span class="">qq2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = r &#8729; (f bs y c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm2</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">qq3</span><span class=""> </span><span class="">fresh2</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;... = f bs y c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">qq3</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="">fcb2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_res_fcb2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">as</span><span class=""> </span><span class="">bs</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;atom set&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;b :: fs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">c</span><span class="delimiter">::</span><span class="string">&quot;&#39;c::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">eq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[as]res. x = [bs]res. y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fin</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite as&quot;</span><span class=""> </span><span class="string">&quot;finite bs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fcb1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(as &#8745; supp x) &#9839;* f (as &#8745; supp x) x c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fresh1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;as &#9839;* c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fresh2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;bs &#9839;* c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">perm1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. supp p &#9839;* c &#10233; p &#8729; (f (as &#8745; supp x) x c) = f (p &#8729; (as &#8745; supp x)) (p &#8729; x) c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">perm2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. supp p &#9839;* c &#10233; p &#8729; (f (bs &#8745; supp y) y c) = f (p &#8729; (bs &#8745; supp y)) (p &#8729; y) c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;f (as &#8745; supp x) x c = f (bs &#8745; supp y) y c&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp (as, x, c) supports (f (as &#8745; supp x) x c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class="">  </span><span class="">supports_def</span><span class=""> </span><span class="">fresh_def</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">perm1</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">supp_swap</span><span class=""> </span><span class="">swap_fresh_fresh</span><span class=""> </span><span class="">inter_eqvt</span><span class=""> </span><span class="">supp_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">fin1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite (supp (f (as &#8745; supp x) x c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">fin</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">supports_finite</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">finite_supp</span><span class=""> </span><span class="">supp_of_finite_sets</span><span class=""> </span><span class="">supp_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp (bs, y, c) supports (f (bs &#8745; supp y) y c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class="">  </span><span class="">supports_def</span><span class=""> </span><span class="">fresh_def</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">perm2</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">supp_swap</span><span class=""> </span><span class="">swap_fresh_fresh</span><span class=""> </span><span class="">inter_eqvt</span><span class=""> </span><span class="">supp_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">fin2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite (supp (f (bs &#8745; supp y) y c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">fin</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">supports_finite</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">finite_supp</span><span class=""> </span><span class="">supp_of_finite_sets</span><span class=""> </span><span class="">supp_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">q</span><span class="delimiter">::</span><span class="string">&quot;perm&quot;</span><span class=""> </span><span class="keyword2">where</span><span class=""> 
</span><span class="">    </span><span class="">fr1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(q &#8729; (as &#8745; supp x)) &#9839;* (x, c, f (as &#8745; supp x) x c, f (bs &#8745; supp y) y c)&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">fr2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp q &#9839;* ([as &#8745; supp x]set. x)&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">inc</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp q &#8838; (as &#8745; supp x) &#8746; (q &#8729; (as &#8745; supp x))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">at_set_avoiding3</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">xs</span><span class="delimiter">=</span><span class="string">&quot;as &#8745; supp x&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;(x, c, f (as &#8745; supp x) x c, f (bs &#8745; supp y) y c)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;[as &#8745; supp x]set. x&quot;</span><span class="delimiter">]</span><span class="">  
</span><span class="">      </span><span class="">fin1</span><span class=""> </span><span class="">fin2</span><span class=""> </span><span class="">fin</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_Pair</span><span class=""> </span><span class="">finite_supp</span><span class=""> </span><span class="">Abs_fresh_star</span><span class=""> </span><span class="">dest</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_supp_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[q &#8729; (as &#8745; supp x)]set. (q &#8729; x) = q &#8729; ([as &#8745; supp x]set. x)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = [as &#8745; supp x]set. x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fr2</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;[q &#8729; (as &#8745; supp x)]set. (q &#8729; x) = [bs &#8745; supp y]set. y&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eq</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_eq_res_set</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">r</span><span class="delimiter">::</span><span class="">perm</span><span class=""> </span><span class="keyword2">where</span><span class=""> 
</span><span class="">    </span><span class="">qq1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; x = r &#8729; y&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">qq2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(q &#8729; as &#8745; supp (q &#8729; x)) = r &#8729; (bs &#8745; supp y)&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">qq3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp r &#8838; (bs &#8745; supp y) &#8746; q &#8729; (as &#8745; supp x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">sym</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_eq_iff2</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">exE</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">conjE</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;p&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">meta_spec</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">set_eqvt</span><span class=""> </span><span class="">inter_eqvt</span><span class=""> </span><span class="">supp_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(as &#8745; supp x) &#9839;* f (as &#8745; supp x) x c&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">fcb1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;q &#8729; ((as &#8745; supp x) &#9839;* f (as &#8745; supp x) x c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_bool_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(q &#8729; (as &#8745; supp x)) &#9839;* f (q &#8729; (as &#8745; supp x)) (q &#8729; x) c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_eqvt</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">asm</span><span class="delimiter">)</span><span class=""> </span><span class="">perm1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">inc</span><span class=""> </span><span class="">fresh1</span><span class=""> </span><span class="">fr1</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(r &#8729; (bs &#8745; supp y)) &#9839;* f (r &#8729; (bs &#8745; supp y)) (r &#8729; y) c&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">qq1</span><span class=""> </span><span class="">qq2</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">perm_simp</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;r &#8729; ((bs &#8745; supp y) &#9839;* f (bs &#8745; supp y) y c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_eqvt</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">asm</span><span class="delimiter">)</span><span class=""> </span><span class="">perm2</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">qq3</span><span class=""> </span><span class="">fresh2</span><span class=""> </span><span class="">fr1</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">set_eqvt</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">fcb2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(bs &#8745; supp y) &#9839;* f (bs &#8745; supp y) y c&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_bool_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;f (as &#8745; supp x) x c = q &#8729; (f (as &#8745; supp x) x c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">inc</span><span class=""> </span><span class="">fcb1</span><span class=""> </span><span class="">fr1</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = f (q &#8729; (as &#8745; supp x)) (q &#8729; x) c&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">inc</span><span class=""> </span><span class="">fresh1</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = f (r &#8729; (bs &#8745; supp y)) (r &#8729; y) c&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">qq1</span><span class=""> </span><span class="">qq2</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">perm_simp</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = r &#8729; (f (bs &#8745; supp y) y c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm2</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">qq3</span><span class=""> </span><span class="">fresh2</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;... = f (bs &#8745; supp y) y c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">qq3</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="">fcb2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_lst_fcb2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">as</span><span class=""> </span><span class="">bs</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;atom list&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;b :: fs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">c</span><span class="delimiter">::</span><span class="string">&quot;&#39;c::fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">eq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[as]lst. x = [bs]lst. y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fcb1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(set as) &#9839;* f as x c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fresh1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;set as &#9839;* c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fresh2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;set bs &#9839;* c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">perm1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. supp p &#9839;* c &#10233; p &#8729; (f as x c) = f (p &#8729; as) (p &#8729; x) c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">perm2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. supp p &#9839;* c &#10233; p &#8729; (f bs y c) = f (p &#8729; bs) (p &#8729; y) c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;f as x c = f bs y c&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp (as, x, c) supports (f as x c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class="">  </span><span class="">supports_def</span><span class=""> </span><span class="">fresh_def</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">perm1</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">supp_swap</span><span class=""> </span><span class="">swap_fresh_fresh</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">fin1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite (supp (f as x c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">supports_finite</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">finite_supp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;supp (bs, y, c) supports (f bs y c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">unfolding</span><span class="">  </span><span class="">supports_def</span><span class=""> </span><span class="">fresh_def</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">perm2</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">supp_swap</span><span class=""> </span><span class="">swap_fresh_fresh</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">fin2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;finite (supp (f bs y c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class=""> </span><span class="">supports_finite</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">finite_supp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">q</span><span class="delimiter">::</span><span class="string">&quot;perm&quot;</span><span class=""> </span><span class="keyword2">where</span><span class=""> 
</span><span class="">    </span><span class="">fr1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(q &#8729; (set as)) &#9839;* (x, c, f as x c, f bs y c)&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">fr2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp q &#9839;* Abs_lst as x&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">inc</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp q &#8838; (set as) &#8746; q &#8729; (set as)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">at_set_avoiding3</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">xs</span><span class="delimiter">=</span><span class="string">&quot;set as&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;(x, c, f as x c, f bs y c)&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;[as]lst. x&quot;</span><span class="delimiter">]</span><span class="">  
</span><span class="">      </span><span class="">fin1</span><span class=""> </span><span class="">fin2</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">supp_Pair</span><span class=""> </span><span class="">finite_supp</span><span class=""> </span><span class="">Abs_fresh_star</span><span class=""> </span><span class="">dest</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_supp_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Abs_lst (q &#8729; as) (q &#8729; x) = q &#8729; Abs_lst as x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = Abs_lst as x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fr2</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Abs_lst (q &#8729; as) (q &#8729; x) = Abs_lst bs y&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eq</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">r</span><span class="delimiter">::</span><span class="">perm</span><span class=""> </span><span class="keyword2">where</span><span class=""> 
</span><span class="">    </span><span class="">qq1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; x = r &#8729; y&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">qq2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;q &#8729; as = r &#8729; bs&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">    </span><span class="">qq3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;supp r &#8838; (q &#8729; (set as)) &#8746; set bs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">sym</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_eq_iff2</span><span class=""> </span><span class="">alphas</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">exE</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">conjE</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;p&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">meta_spec</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">blast</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(set as) &#9839;* f as x c&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">fcb1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;q &#8729; ((set as) &#9839;* f as x c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_bool_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;set (q &#8729; as) &#9839;* f (q &#8729; as) (q &#8729; x) c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_eqvt</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">asm</span><span class="delimiter">)</span><span class=""> </span><span class="">perm1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">inc</span><span class=""> </span><span class="">fresh1</span><span class=""> </span><span class="">fr1</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;set (r &#8729; bs) &#9839;* f (r &#8729; bs) (r &#8729; y) c&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">qq1</span><span class=""> </span><span class="">qq2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;r &#8729; ((set bs) &#9839;* f bs y c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_eqvt</span><span class=""> </span><span class="">set_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="delimiter">(</span><span class="">asm</span><span class="delimiter">)</span><span class=""> </span><span class="">perm2</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">qq3</span><span class=""> </span><span class="">fresh2</span><span class=""> </span><span class="">fr1</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">set_eqvt</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">fcb2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(set bs) &#9839;* f bs y c&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">permute_bool_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;f as x c = q &#8729; (f as x c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">inc</span><span class=""> </span><span class="">fcb1</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = f (q &#8729; as) (q &#8729; x) c&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">inc</span><span class=""> </span><span class="">fresh1</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = f (r &#8729; bs) (r &#8729; y) c&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">qq1</span><span class=""> </span><span class="">qq2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8230; = r &#8729; (f bs y c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm2</span><span class="delimiter">[</span><span class="">symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">qq3</span><span class=""> </span><span class="">fresh2</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;... = f bs y c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">qq3</span><span class=""> </span><span class="">fr1</span><span class=""> </span><span class="">fcb2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">finally</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_lst1_fcb2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;atom&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;b :: fs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">c</span><span class="delimiter">::</span><span class="string">&quot;&#39;c :: fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[[a]]lst. x = [[b]]lst. y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fcb1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &#9839; f a x c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fresh</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;{a, b} &#9839;* c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">perm1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. supp p &#9839;* c &#10233; p &#8729; (f a x c) = f (p &#8729; a) (p &#8729; x) c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">perm2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. supp p &#9839;* c &#10233; p &#8729; (f b y c) = f (p &#8729; b) (p &#8729; y) c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;f a x c = f b y c&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">e</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">Abs_lst_fcb2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;c&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">f</span><span class="delimiter">=</span><span class="string">&quot;&#955;(as::atom list) . f (hd as)&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">fcb1</span><span class=""> </span><span class="">fresh</span><span class=""> </span><span class="">perm1</span><span class=""> </span><span class="">perm2</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Abs_lst1_fcb2&#39;</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;a::at&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;b :: fs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class=""> </span><span class="">c</span><span class="delimiter">::</span><span class="string">&quot;&#39;c :: fs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[[atom a]]lst. x = [[atom b]]lst. y&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fcb1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;atom a &#9839; f a x c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">fresh</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;{atom a, atom b} &#9839;* c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">perm1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. supp p &#9839;* c &#10233; p &#8729; (f a x c) = f (p &#8729; a) (p &#8729; x) c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">perm2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;p. supp p &#9839;* c &#10233; p &#8729; (f b y c) = f (p &#8729; b) (p &#8729; y) c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;f a x c = f b y c&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">e</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">Abs_lst1_fcb2</span><span class="delimiter">[</span><span class="keyword2">where</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;c&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">f</span><span class="delimiter">=</span><span class="string">&quot;&#955;a . f ((inv atom) a)&quot;</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class="">  </span><span class="">fcb1</span><span class=""> </span><span class="">fresh</span><span class=""> </span><span class="">perm1</span><span class=""> </span><span class="">perm2</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">inv_f_f</span><span class=""> </span><span class="">inj_on_def</span><span class=""> </span><span class="">atom_eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="keyword2">end</span></pre>

</div>
</body>
</html>
