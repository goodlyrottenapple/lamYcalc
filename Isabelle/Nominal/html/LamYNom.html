<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory LamYNom (Isabelle2016: February 2016)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory LamYNom</h1>

<span class="command">theory</span> <span class="name">LamYNom</span><br/>
<span class="keyword">imports</span> <a href="Nominal2.html"><span class="name">Nominal2</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Nominal implementation in Isabelle *}</span><span class="">
</span><span class="comment">(*Disclaimer: Some of the definitions were copied over and adapted from 
Nominal2-Isabelle2015/Nominal/Nominal2/Ex/Lambda.thy *)</span><span class="">
</span><span class="">
</span><span class="keyword1">theory</span><span class=""> </span><span class="">LamYNom</span><span class="">
</span><span class="keyword2">imports</span><span class=""> </span><span class="string">&quot;Nominal2-Isabelle/Nominal/Nominal2&quot;</span><span class=""> </span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Definition of $\lamy$ terms *}</span><span class="">
</span><span class="">
</span><span class="keyword1">atom_decl</span><span class=""> </span><span class="">name</span><span class="">
</span><span class="">
</span><span class="keyword1">nominal_datatype</span><span class=""> </span><span class="">type</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">O</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">Arr</span><span class=""> </span><span class="">type</span><span class=""> </span><span class="">type</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &#8594; _&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">nominal_datatype</span><span class=""> </span><span class="">trm</span><span class=""> </span><span class="delimiter">=</span><span class="">
</span><span class="">  </span><span class="">Var</span><span class=""> </span><span class="">name</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">App</span><span class=""> </span><span class="">trm</span><span class=""> </span><span class="">trm</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Lam</span><span class=""> </span><span class="">x</span><span class="delimiter">::</span><span class="">name</span><span class=""> </span><span class="">l</span><span class="delimiter">::</span><span class="">trm</span><span class="">  </span><span class="keyword2">binds</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">l</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;Lam [_]. _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">100</span><span class="delimiter">,</span><span class=""> </span><span class="">100</span><span class="delimiter">]</span><span class=""> </span><span class="">100</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">type</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Definition of substitution *}</span><span class="">
</span><span class="">
</span><span class="keyword1">nominal_function</span><span class="">
</span><span class="">  </span><span class="">subst</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;trm &#8658; name &#8658; trm &#8658; trm&quot;</span><span class="">  </span><span class="delimiter">(</span><span class="string">&quot;_ [_ ::= _]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">90</span><span class="delimiter">,</span><span class=""> </span><span class="">90</span><span class="delimiter">,</span><span class=""> </span><span class="">90</span><span class="delimiter">]</span><span class=""> </span><span class="">90</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;(Var x)[y ::= s] = (if x = y then s else (Var x))&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;(App t1 t2)[y ::= s] = App (t1[y ::= s]) (t2[y ::= s])&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;atom x &#9839; (y, s) &#10233; (Lam [x]. t)[y ::= s] = Lam [x].(t[y ::= s])&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;(Y t)[y ::= s] = Y t&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqvt_def</span><span class=""> </span><span class="">subst_graph_aux_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">TrueI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">[</span><span class="">simproc</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">alpha_lst</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">auto</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">y</span><span class="delimiter">=</span><span class="string">&quot;a&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;(aa, b)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">trm.strong_exhaust</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">blast</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair_elim</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;(ya,sa)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">Abs_lst1_fcb2</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Abs_fresh_iff</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">eqvt_at_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_Pair</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class=""> </span><span class="">eqvt_at_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">perm_simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_Pair</span><span class=""> </span><span class="">perm_supp_eq</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="keyword1">nominal_termination</span><span class=""> </span><span class="delimiter">(</span><span class="">eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">lexicographic_order</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">forget</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;atom x &#9839; t &#10233; t[x ::= s] = t&quot;</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">avoiding</span><span class="delimiter">:</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_at_base</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">fresh_type</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">n</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">name</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">type</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;atom n &#9839; t&quot;</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">type.strong_induct</span><span class="delimiter">,</span><span class=""> </span><span class="">auto</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">fresh_fact</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">z</span><span class="delimiter">::</span><span class="string">&quot;name&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;atom z &#9839; s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="">b</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;z = y &#8744; atom z &#9839; t&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;atom z &#9839; t[y ::= s]&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">avoiding</span><span class="delimiter">:</span><span class=""> </span><span class="">z</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">fresh_type</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">substitution_lemma</span><span class="delimiter">:</span><span class="">  
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x &#8800; y&quot;</span><span class=""> </span><span class="string">&quot;atom x &#9839; u&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;t[x ::= s][y ::= u] = t[y ::= u][x ::= s[y ::= u]]&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> 
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">avoiding</span><span class="delimiter">:</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">u</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_fact</span><span class=""> </span><span class="">forget</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{*$\beta Y$-reduction*}</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> 
</span><span class="">  </span><span class="">beta_Y</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;trm &#8658; trm &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot; _ &#8658; _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">80</span><span class="delimiter">,</span><span class="">80</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">red_L</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; M &#8658; M&#39; &#10215; &#10233; App M N &#8658; App M&#39; N&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">red_R</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; N &#8658; N&#39; &#10215; &#10233; App M N &#8658; App M N&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">abs</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; M &#8658; M&#39; &#10215; &#10233; Lam [x]. M &#8658; Lam [x]. M&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">beta</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; atom x &#9839; N &#10215; &#10233; App (Lam [x]. M) N &#8658; M[x ::= N]&quot;</span><span class="">
</span><span class="comment">(*| eta[intro]: &quot;&#10214; atom x &#9839; M &#10215; &#10233; App (Lam [x]. M) (Var x) &#8658;Y M&quot;*)</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Y</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;App (Y &#963;) M &#8658; App M (App (Y &#963;) M)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">equivariance</span><span class=""> </span><span class="">beta_Y</span><span class="">
</span><span class="keyword1">nominal_inductive</span><span class=""> </span><span class="">beta_Y</span><span class="">
</span><span class="">  </span><span class="keyword2">avoids</span><span class=""> </span><span class="">beta</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x&quot;</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">abs</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x&quot;</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">fresh_fact</span><span class=""> </span><span class="">fresh_type</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Parallel $\beta Y$-reduction *}</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> 
</span><span class="">  </span><span class="">pbeta</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;trm &#8658; trm &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &#8811; _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">80</span><span class="delimiter">,</span><span class="">80</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">refl</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Var x) &#8811; (Var x)&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">reflY</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Y &#963; &#8811; Y &#963;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">app</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; M &#8811; M&#39; ; N &#8811; N&#39; &#10215; &#10233; App M N &#8811; App M&#39; N&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">abs</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; M &#8811; M&#39; &#10215; &#10233; Lam [x]. M &#8811; Lam [x]. M&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">beta</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; atom x &#9839; N ; atom x &#9839; N&#39; ; M &#8811; M&#39; ; N &#8811; N&#39; &#10215; &#10233; App (Lam [x]. M) N &#8811; M&#39;[x ::= N&#39;]&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Y</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; M &#8811; M&#39; &#10215; &#10233; App (Y &#963;) M &#8811; App M&#39; (App (Y &#963;) M&#39;)&quot;</span><span class="">
</span><span class="keyword1">equivariance</span><span class=""> </span><span class="">pbeta</span><span class="">
</span><span class="">
</span><span class="keyword1">nominal_inductive</span><span class=""> </span><span class="">pbeta</span><span class="">
</span><span class=""> </span><span class="keyword2">avoids</span><span class=""> </span><span class="">beta</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x&quot;</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">abs</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x&quot;</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">fresh_fact</span><span class=""> </span><span class="">fresh_type</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Maximal parallel $\beta Y$-reduction *}</span><span class="">
</span><span class="">
</span><span class="keyword1">nominal_function</span><span class=""> 
</span><span class="">  </span><span class="">not_abst</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;trm &#8658; bool&quot;</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;not_abst (Var x) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_abst (App t1 t2) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_abst (Lam [x]. t) = False&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_abst (Y t) = True&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqvt_def</span><span class=""> </span><span class="">not_abst_graph_aux_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">TrueI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">y</span><span class="delimiter">=</span><span class="string">&quot;x&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">trm.exhaust</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">[</span><span class="">simproc</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">alpha_lst</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">nominal_termination</span><span class=""> </span><span class="delimiter">(</span><span class="">eqvt</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">lexicographic_order</span><span class="">
</span><span class="">
</span><span class="keyword1">nominal_function</span><span class=""> 
</span><span class="">  </span><span class="">not_Y</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;trm &#8658; bool&quot;</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;not_Y (Var x) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_Y (App t1 t2) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_Y (Lam [x]. t) = True&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="string">&quot;not_Y (Y t) = False&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqvt_def</span><span class=""> </span><span class="">not_Y_graph_aux_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">TrueI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">y</span><span class="delimiter">=</span><span class="string">&quot;x&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">trm.exhaust</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">[</span><span class="">simproc</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">alpha_lst</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">nominal_termination</span><span class=""> </span><span class="delimiter">(</span><span class="">eqvt</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">lexicographic_order</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> 
</span><span class="">  </span><span class="">pbeta_max</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;trm &#8658; trm &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &gt;&gt;&gt; _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">80</span><span class="delimiter">,</span><span class="">80</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">refl</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Var x) &gt;&gt;&gt; (Var x)&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">reflY</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Y &#963; &gt;&gt;&gt; Y &#963;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">app</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; not_abst M ; not_Y M ;  M &gt;&gt;&gt; M&#39; ; N &gt;&gt;&gt; N&#39; &#10215; &#10233; App M N &gt;&gt;&gt; App M&#39; N&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">abs</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; M &gt;&gt;&gt; M&#39; &#10215; &#10233; Lam [x]. M &gt;&gt;&gt; Lam [x]. M&#39;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">beta</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; atom x &#9839; N ; atom x &#9839; N&#39; ; M &gt;&gt;&gt; M&#39; ; N &gt;&gt;&gt; N&#39; &#10215; &#10233; App (Lam [x]. M) N &gt;&gt;&gt; M&#39;[x ::= N&#39;]&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Y</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; M &gt;&gt;&gt; M&#39; &#10215; &#10233; App (Y &#963;) M &gt;&gt;&gt; App M&#39; (App (Y &#963;) M&#39;)&quot;</span><span class="">
</span><span class="keyword1">equivariance</span><span class=""> </span><span class="">pbeta_max</span><span class="">
</span><span class="">
</span><span class="keyword1">nominal_inductive</span><span class=""> </span><span class="">pbeta_max</span><span class="">
</span><span class="">  </span><span class="keyword2">avoids</span><span class=""> </span><span class="">beta</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x&quot;</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">abs</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x&quot;</span><span class=""> </span><span class="comment">(*don&#39;t understand what this does exactly or why we need it in the abs case ...*)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">fresh_fact</span><span class=""> </span><span class="">fresh_type</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">not_Y_ex</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(not_Y M) &#10233; &#8707;&#963;. M = Y &#963;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">not_Y.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* \cref{Lemma:maxEx} *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_max_ex</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">M</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;M&#39;. M &gt;&gt;&gt; M&#39;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;not_abst trm1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;not_Y trm1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">1</span><span class=""> </span><span class="">P</span><span class=""> </span><span class="">Q</span><span class=""> </span><span class="">P&#39;</span><span class=""> </span><span class="">Q&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;P = Y &#963;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">not_Y_ex</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;App (Y &#963;) Q &gt;&gt;&gt; App Q&#39; (App (Y &#963;) Q&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta_max.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">2</span><span class=""> </span><span class="">P</span><span class=""> </span><span class="">Q</span><span class=""> </span><span class="">P&#39;</span><span class=""> </span><span class="">Q&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">P</span><span class=""> </span><span class="">P&#39;</span><span class=""> </span><span class="">avoiding</span><span class="delimiter">:</span><span class=""> </span><span class="">Q</span><span class=""> </span><span class="">Q&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta_max.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* \cref{Lemma:maxClose} *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_rename</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;atom y &#9839; t&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;t[x ::= s] = ((y &#8596; x) &#8729; t)[y ::= s]&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">a</span><span class=""> 
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">avoiding</span><span class="delimiter">:</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_at_base</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class=""> </span><span class="">fresh_type</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">fresh_in_pbeta</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s &#8811; s&#39; &#10233; atom (x::name) &#9839; s &#10233;  atom x &#9839; s&#39;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">2</span><span class=""> </span><span class="">xx</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">N&#39;</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;atom x &#9839; N&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="string">&quot;x = xx&quot;</span><span class=""> </span><span class="keyword1">with</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_fact</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class=""> </span><span class="keyword3">assume</span><span class=""> </span><span class="string">&quot;x &#8800; xx&quot;</span><span class=""> </span><span class="keyword1">with</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_fact</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="cartouche">&#8249;x = xx &#10233; atom x &#9839; M&#39; [xx ::= N&#39;]&#8250;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_lam_case_ex</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Lam [x]. s) &#8811; s&#39; &#10233; &#8707;t. s&#39; = Lam [x]. t &#8743; s &#8811; t&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;(Lam [x]. s)&quot;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">goal1</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">x&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s &#8811; ((x&#39; &#8596; x) &#8729; M&#39;)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">pbeta.eqvt</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Abs1_eq_iff</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">Nominal2_Base.swap_self</span><span class=""> </span><span class="">add_flip_cancel</span><span class=""> </span><span class="">flip_commute</span><span class=""> </span><span class="">flip_def</span><span class=""> </span><span class="">permute_flip_cancel2</span><span class=""> </span><span class="">permute_plus</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">goal1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(x&#39; &#8596; x) &#8729; s&#39; = Lam [x]. ((x&#39; &#8596; x) &#8729; M&#39;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">goal1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;atom x &#9839; (Lam [x&#39;]. M&#39;)&quot;</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">fresh_in_pbeta</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">trm.fresh</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">list.set_intros</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s&#39; = Lam [x]. ((x&#39; &#8596; x) &#8729; M&#39;)&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">goal1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="string">&quot;2&quot;</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class=""> </span><span class="">goal1</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">trm.fresh</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">list.set_intros</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_cases_2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;atom x &#9839; t &#10233; App (Lam [x]. s) t &#8811; a2 &#10233; 
    (&#8896;s&#39; t&#39;. a2 = App (Lam [x]. s&#39;) t&#39; &#10233; atom x &#9839; t&#39; &#10233; s &#8811; s&#39; &#10233; t &#8811; t&#39; &#10233; P) &#10233;
    (&#8896;t&#39; s&#39;. a2 = s&#39; [x ::= t&#39;] &#10233; atom x &#9839; t &#10233; atom x &#9839; t&#39; &#10233; s &#8811; s&#39; &#10233; t &#8811; t&#39; &#10233; P) &#10233; P&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">atomize_elim</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;App (Lam [x]. s) t&quot;</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">goal1</span><span class=""> 
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">s&#39;&#39;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M&#39; = Lam [x]. s&#39;&#39;&quot;</span><span class=""> </span><span class="string">&quot;s &#8811; s&#39;&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">pbeta_lam_case_ex</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">goal1</span><span class=""> </span><span class="">fresh_in_pbeta</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">goal2</span><span class=""> </span><span class="">xx</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">ss</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M&#39; [xx ::= N&#39;] = ((x &#8596; xx) &#8729; M&#39;) [x ::= N&#39;]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Abs1_eq_iff</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">Nominal2_Base.swap_self</span><span class=""> </span><span class="">add_flip_cancel</span><span class=""> </span><span class="">flip_def</span><span class=""> </span><span class="">fresh_in_pbeta</span><span class=""> </span><span class="">goal2</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">goal2</span><span class="delimiter">(</span><span class="">7</span><span class="delimiter">)</span><span class=""> </span><span class="">permute_flip_cancel</span><span class=""> </span><span class="">permute_plus</span><span class=""> </span><span class="">subst_rename</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">goal2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s &#8811; ((x &#8596; xx) &#8729; M&#39;)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Abs1_eq_iff</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">Nominal2_Base.swap_self</span><span class=""> </span><span class="">add_flip_cancel</span><span class=""> </span><span class="">flip_def</span><span class=""> </span><span class="">pbeta.eqvt</span><span class=""> </span><span class="">permute_flip_cancel</span><span class=""> </span><span class="">permute_plus</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">goal2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;atom x &#9839; N&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">fresh_in_pbeta</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">goal2</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Lem2_5_1</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;s &#8811; s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;t &#8811; t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(s[x ::= t]) &#8811; (s&#39;[x ::= t&#39;])&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">avoiding</span><span class="delimiter">:</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">refl</span><span class=""> </span><span class="">s</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">reflY</span><span class=""> </span><span class="">s</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">app</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.app</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">app</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">p</span><span class=""> </span><span class="">p&#39;</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst.simps</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst.simps</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="">q</span><span class=""> </span><span class="">q&#39;</span><span class=""> </span><span class="">p</span><span class=""> </span><span class="">p&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;App ((Lam [y]. p) [x ::= t]) (q [x ::= t]) &#8811; (p&#39; [x ::= t&#39;])[y ::= q&#39;[x ::= t&#39;]]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta.beta</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_fact</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">substitution_lemma</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_fact</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Y</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">&#963;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_max_closes_pbeta</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">d</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;a &gt;&gt;&gt; d&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;a &#8811; b&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;b &#8811; d&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta_max.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">refl</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">  
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">refl</span><span class=""> </span><span class="">pbeta.cases</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">reflY</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;b = Y a&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">pbeta.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">Q</span><span class=""> </span><span class="">Qmax</span><span class=""> </span><span class="">P</span><span class=""> </span><span class="">Pmax</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">beta</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">,</span><span class="">7</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta_cases_2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">goal2</span><span class=""> </span><span class="">Q&#39;</span><span class=""> </span><span class="">P&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;P&#39; &#8811; Pmax&quot;</span><span class=""> </span><span class="string">&quot;Q&#39; &#8811; Qmax&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">    </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">goal2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">Lem2_5_1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">goal1</span><span class=""> </span><span class="">P&#39;</span><span class=""> </span><span class="">Q&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">ih</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;P&#39; &#8811; Pmax&quot;</span><span class=""> </span><span class="string">&quot;Q&#39; &#8811; Qmax&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">goal1</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta.beta</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">goal1</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="">ih</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">app</span><span class=""> </span><span class="">al</span><span class=""> </span><span class="">ald</span><span class=""> </span><span class="">ar</span><span class=""> </span><span class="">ard</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">app</span><span class="delimiter">(</span><span class="">7</span><span class="delimiter">,</span><span class="">1</span><span class="delimiter">,</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;App al ar&quot;</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">app</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">al</span><span class=""> </span><span class="">ald</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">pbeta_lam_case_ex</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Y</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">&#963;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">Y</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">1</span><span class=""> </span><span class="">M&#39;&#39;</span><span class=""> </span><span class="">N&#39;&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M&#39;&#39; = Y &#963;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">2</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">2</span><span class=""> </span><span class="">M&#39;&#39;</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">2</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pbeta.reflY</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Proof of $\dip(\gg)$ *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">Lem2_5_2</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;a &#8811; b&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;a &#8811; c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;d. b &#8811; d &#8743; c &#8811; d&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword3">obtain</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;a &gt;&gt;&gt; d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">pbeta_max_ex</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;b &#8811; d &#8743; c &#8811; d&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">rule</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta_max_closes_pbeta</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">pbeta_max_closes_pbeta</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Reflexive-transitive closure of $\beta Y$ *}</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> </span><span class="">close</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(trm &#8658; trm &#8658; bool) &#8658; trm &#8658; trm &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_* _  _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">80</span><span class="delimiter">,</span><span class="">80</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">for</span><span class=""> </span><span class="">R</span><span class="delimiter">::</span><span class="string">&quot;trm &#8658; trm &#8658; bool&quot;</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">base</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;R a b &#10233; R* a b&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">refl</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;R* a a&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">trans</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; R* a b ; R* b c &#10215; &#10233; R* a c&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Proof of $\dip(\red^*)$ *}</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">DP</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(trm &#8658; trm &#8658; bool) &#8658; (trm &#8658; trm &#8658; bool) &#8658; bool&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;DP R T = (&#8704;a b c. R a b &#8743; T a c &#10230; (&#8707;d. T b d &#8743; R c d))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">DP_R_R_imp_DP_R_Rc_pbeta</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;DP pbeta pbeta&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;DP pbeta (close pbeta)&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">DP_def</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">goal1</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">goal1</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">,</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">goal1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">DP_R_R_imp_DP_Rc_Rc_pbeta</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;DP pbeta pbeta&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;DP (close pbeta) (close pbeta)&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">DP_def</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">goal1</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">goal1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">,</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">DP_R_R_imp_DP_R_Rc_pbeta</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">DP_def</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">pbeta_refl</span><span class="delimiter">[</span><span class="">intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s &#8811; s&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">trm.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">M1&#39;</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M &#8658; M&#39; &#10233; M &#8811; M&#39;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">beta_Y.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">M1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;beta_Y* M M&#39; &#10233; pbeta* M M&#39;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">base</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">M1&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">red_r_close</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;beta_Y* N N&#39; &#10233; beta_Y* (App M N) (App M N&#39;)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">red_l_close</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;beta_Y* M M&#39; &#10233; beta_Y* (App M N) (App M&#39; N)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">abs_close</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;beta_Y* M M&#39; &#10233; beta_Y* (Lam [x]. M) (Lam [x]. M&#39;)&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">M2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pbeta* M M&#39; &#10233; beta_Y* M M&#39;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">refl</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.refl</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">trans</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">base</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">pbeta.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="">refl</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.refl</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="">reflY</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.refl</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">app</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">N&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">=</span><span class="string">&quot;App M N&#39;&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">red_r_close</span><span class=""> </span><span class="">app.hyps</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">red_l_close</span><span class=""> </span><span class="">app.hyps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="">abs_close</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">N&#39;</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">=</span><span class="string">&quot;App (Lam [x]. M&#39;) N&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">red_l_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">abs_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">=</span><span class="string">&quot;App (Lam [x]. M&#39;) N&#39;&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">red_r_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.base</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">beta_Y.beta</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">beta</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Y</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">&#963;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">=</span><span class="string">&quot;App M (App (Y &#963;) M)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">close.base</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">beta_Y.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">b</span><span class="delimiter">=</span><span class="string">&quot;App M&#39; (App (Y &#963;) M)&quot;</span><span class=""> </span><span class="keyword2">in</span><span class=""> </span><span class="">close.trans</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">red_l_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">red_r_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">red_r_close</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Simple-typing relation $\vdash$ *}</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class=""> </span><span class="">wf_ctxt</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(name &#215; type) list &#8658; bool&quot;</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">    </span><span class="">nil</span><span class="delimiter">:</span><span class="">  </span><span class="string">&quot;wf_ctxt []&quot;</span><span class="">
</span><span class="">  </span><span class="delimiter">|</span><span class=""> </span><span class="">cons</span><span class="delimiter">:</span><span class="">  </span><span class="string">&quot;&#10214; wf_ctxt &#915; ; atom x &#9839; &#915; &#10215; &#10233; wf_ctxt ((x,&#963;)#&#915;)&quot;</span><span class="">
</span><span class="keyword1">equivariance</span><span class=""> </span><span class="">wf_ctxt</span><span class="">
</span><span class="">
</span><span class="keyword1">inductive</span><span class="">
</span><span class="">  </span><span class="">wt_terms</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(name &#215; type) list &#8658; trm &#8658; type &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_ &#8866; _ : _&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="">var</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; (x,&#963;) &#8712; set &#915; ; wf_ctxt &#915; &#10215; &#10233; &#915; &#8866; Var x : &#963;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">app</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; &#915; &#8866; M : &#963; &#8594; &#964; ; &#915; &#8866; N : &#963; &#10215; &#10233; &#915; &#8866; App M N : &#964;&quot;</span><span class="">
</span><span class="comment">(* condition &quot;atom x &#9839; &#915;&quot; in abst should ensure that (x,&#963;) is consistent with &#915; *)</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">abs</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; atom x &#9839; &#915; ; ((x,&#963;)#&#915;) &#8866; M : &#964; &#10215; &#10233; &#915; &#8866; Lam [x]. M : &#963; &#8594; &#964;&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Y</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; wf_ctxt &#915; &#10215; &#10233;  &#915; &#8866; Y &#963; : (&#963; &#8594; &#963;) &#8594; &#963;&quot;</span><span class="">
</span><span class="keyword1">equivariance</span><span class=""> </span><span class="">wt_terms</span><span class="">
</span><span class="">
</span><span class="keyword1">nominal_inductive</span><span class=""> </span><span class="">wt_terms</span><span class="">
</span><span class="keyword2">avoids</span><span class=""> </span><span class="">abs</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x&quot;</span><span class=""> 
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_star_def</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">fresh_fact</span><span class=""> </span><span class="">fresh_type</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Subject reduction theorem for $\red$ *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt ((x, &#963;)#&#915;) &#10233; wf_ctxt &#915; &#8743; atom x &#9839; &#915;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wf_ctxt.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#963; &#10233; wf_ctxt &#915;&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">weakening</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">fixes</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">&#915;&#39;</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">&#963;</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#963;&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;set &#915; &#8838; set &#915;&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;wf_ctxt &#915;&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#915;&#39; &#8866; M : &#963;&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">avoiding</span><span class="delimiter">:</span><span class=""> </span><span class="">&#915;&#39;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">var</span><span class=""> 
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.var</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">var</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">app</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.app</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">app</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">&#964;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt ((x, &#963;) # &#915;&#39;)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="string">&quot;1&quot;</span><span class=""> </span><span class="">wf_ctxt.cases</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">abs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">wt_terms.Y</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">wf_ctxt_exchange</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt ((x,&#963;) # (y,&#960;) # &#915;) &#10233; wf_ctxt ((y,&#960;) # (x,&#963;) # &#915;)&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">1</span><span class=""> 
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt ((y,&#960;) # &#915;)&quot;</span><span class=""> </span><span class="string">&quot;atom x &#9839; ((y,&#960;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt &#915;&quot;</span><span class=""> </span><span class="string">&quot;atom y &#9839; &#915;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;atom x &#9839; &#915;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">fresh_Cons</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">2</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;atom y &#9839; ((x,&#963;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fresh_Cons</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">fresh_at_base</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">fresh_type</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="">4</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">exchange</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(x,&#963;) # (y,&#960;) # &#915; &#8866; M : &#948; &#10233; (y,&#960;) # (x,&#963;) # &#915; &#8866; M : &#948;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">1</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;set ((x,&#963;) # (y,&#960;) # &#915;) &#8838; set ((y,&#960;) # (x,&#963;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">weakening</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="">wf_ctxt_exchange</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class="">  </span><span class="">wt_terms_cases_2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#915; &#8866; Lam [x]. M : a3 &#10233; atom x &#9839; &#915;&#10233; (&#8896;&#963; &#964;. a3 = &#963; &#8594; &#964; &#10233; ((x, &#963;)#&#915;) &#8866; M : &#964; &#10233; P) &#10233; P&quot;</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">atomize_elim</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="string">&quot;Lam [x]. M&quot;</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">goal_cases</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">1</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">&#964;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;M = (x&#39; &#8596; x) &#8729; M&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Abs1_eq_iff&#39;</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">Nominal2_Base.swap_self</span><span class=""> </span><span class="">flip_commute</span><span class=""> </span><span class="">flip_def</span><span class=""> </span><span class="">permute_zero</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((x&#39; &#8596; x) &#8729; ((x&#39;, &#963;) # &#915;)) &#8866; (x&#39; &#8596; x) &#8729; M&#39; : (x&#39; &#8596; x) &#8729; &#964;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">wt_terms.eqvt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="">fresh_type</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((x&#39; &#8596; x) &#8729; ((x&#39;, &#963;) # &#915;)) &#8866; M : &#964;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(x&#39; &#8596; x) &#8729; (x&#39;, &#963;) = (x, &#963;)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">fresh_type</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(x&#39; &#8596; x) &#8729; ((x&#39;, &#963;) # &#915;) = (x, &#963;) # ((x&#39; &#8596; x) &#8729; &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(x, &#963;) # ((x&#39; &#8596; x) &#8729; &#915;) &#8866; M : &#964;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">4</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(x, &#963;) # &#915; &#8866; M : &#964;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">flip_fresh_fresh</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">1</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_typ_aux</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(x, &#964;) # &#915; &#8866; Var y : &#963; &#10233; x = y &#10233; &#964; = &#963;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">ccontr</span><span class="delimiter">,</span><span class=""> </span><span class="">goal_cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="">1</span><span class=""> 
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;wf_ctxt ((y, &#964;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;atom y &#9839; &#915;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(y, &#963;) &#8713; set &#915;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">fresh_Cons</span><span class=""> </span><span class="">fresh_PairD</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">fresh_append</span><span class=""> </span><span class="">fresh_at_base</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">split_list</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(y, &#963;) &#8713; set ((y, &#964;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(y, &#963;) &#8712; set ((y, &#964;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">subst_typ</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;((x,&#964;)#&#915;) &#8866; M : &#963;&quot;</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N : &#964;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M[x ::= N] : &#963;&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">avoiding</span><span class="delimiter">:</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">trm.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Var</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;x = y&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="">True</span><span class=""> 
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">True</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Var</span><span class=""> </span><span class="">subst_typ_aux</span><span class=""> </span><span class="">True</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">  </span><span class="keyword3">case</span><span class=""> </span><span class="">False</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">Var</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;wf_ctxt &#915;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">Var</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(y,&#963;) &#8712; set ((x, &#964;) # &#915;)&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">False</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(y,&#963;) &#8712; set &#915;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">False</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Var</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">wt_terms.var</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">App</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">N&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">App</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#960;</span><span class=""> </span><span class="keyword2">where</span><span class="">  </span><span class="string">&quot;(x, &#964;) # &#915; &#8866; M&#39; : &#960; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;(x, &#964;) # &#915; &#8866; N&#39; : &#960;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">App</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">,</span><span class="">2</span><span class="delimiter">,</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">ih</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M&#39;[x ::= N] : &#960; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N&#39;[x ::= N] : &#960;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.app</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">ih</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Lam</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">Lam</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#960;</span><span class=""> </span><span class="">&#948;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#963; = &#960; &#8594; &#948;&quot;</span><span class=""> </span><span class="string">&quot;(x, &#964;) # &#915; &#8866; Lam [x&#39;]. M : &#960; &#8594; &#948;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(x&#39;, &#960;) # (x, &#964;) # &#915; &#8866; M : &#948;&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms_cases_2</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">Lam</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">,</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">fresh_Cons</span><span class=""> </span><span class="">fresh_Pair</span><span class=""> </span><span class="">fresh_type</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(x, &#964;) # (x&#39;, &#960;) # &#915; &#8866; M : &#948;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">exchange</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">Lam</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">,</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">ih</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(x&#39;, &#960;) # &#915; &#8866; M [x ::= N] : &#948;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">Lam.hyps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">cons</span><span class=""> </span><span class="">set_subset_Cons</span><span class=""> </span><span class="">weakening</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">subst.simps</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">Lam</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">Lam</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">ih</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Y</span><span class=""> </span><span class="">&#947;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">Y</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#963; = (&#947; &#8594; &#947;) &#8594; &#947;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">subst.simps</span><span class=""> </span><span class="">1</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="">wf_ctxt_cons</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">beta_Y_typ</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#963;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;M &#8658; M&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M&#39; : &#963;&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">,</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="delimiter">(</span><span class="">nominal_induct</span><span class="">  </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">avoiding</span><span class="delimiter">:</span><span class=""> </span><span class="">&#915;</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">beta_Y.strong_induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">red_L</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">N</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">red_L</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#964;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#964; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N : &#964;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">red_L</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M&#39; : &#964; &#8594; &#963;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">red_R</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">N&#39;</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">red_R</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#964;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#964; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N : &#964;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">red_R</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N&#39; : &#964;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">abs</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">abs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#960;</span><span class=""> </span><span class="">&#964;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#963; = &#960; &#8594; &#964;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; Lam [x]. M : &#960; &#8594; &#964;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">abs.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">abs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((x,&#960;)#&#915;) &#8866; M : &#964;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms_cases_2</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">abs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((x,&#960;)#&#915;) &#8866; M&#39; : &#964;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.abs</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">abs</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="">3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">beta</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">N</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">beta</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#964;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; Lam [x]. M : &#964; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; N : &#964;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">beta</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((x,&#964;)#&#915;) &#8866; M : &#963;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms_cases_2</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">subst_typ</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">2</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">next</span><span class="">
</span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Y</span><span class=""> </span><span class="">&#964;</span><span class=""> </span><span class="">M</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">&#960;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#915; &#8866; (Y &#964;) : &#960; &#8594; &#963;&quot;</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#960;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#915; &#8866; (Y &#964;) : (&#964; &#8594; &#964;) &#8594; &#964;&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">with</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#960; &#8594; &#963; = (&#964; &#8594; &#964;) &#8594; &#964;&quot;</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class="">wt_terms.cases</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#960; = &#964; &#8594; &#964;&quot;</span><span class=""> </span><span class="string">&quot;&#963; = &#964;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">subst</span><span class=""> </span><span class="">2</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">defer</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.app</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">wt_terms.Y</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">wt_terms_impl_wf_ctxt</span><span class=""> </span><span class="">Y</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">1</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">2</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">beta_Y_c_typ</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M : &#963;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;beta_Y* M M&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#915; &#8866; M&#39; : &#963;&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">assms</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">,</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">M</span><span class=""> </span><span class="">M&#39;</span><span class=""> </span><span class="">arbitrary</span><span class="delimiter">:</span><span class=""> </span><span class="">&#963;</span><span class=""> </span><span class="">rule</span><span class="delimiter">:</span><span class=""> </span><span class="">close.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">beta_Y_typ</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Church Rosser Theorem *}</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">church_rosser_typ</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="string">&quot;&#915; &#8866; a : &#963;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;beta_Y* a b&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class=""> </span><span class="string">&quot;beta_Y* a c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;&#8707;d. beta_Y* b d &#8743; beta_Y* c d &#8743; &#915; &#8866; d : &#963;&quot;</span><span class="">
</span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">from</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;pbeta* a b&quot;</span><span class=""> </span><span class="string">&quot;pbeta* a c&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">M1</span><span class=""> </span><span class="">base</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">d</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;pbeta* b d&quot;</span><span class=""> </span><span class="string">&quot;pbeta* c d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">DP_R_R_imp_DP_Rc_Rc_pbeta</span><span class=""> </span><span class="">DP_def</span><span class=""> </span><span class="">Lem2_5_2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">M2</span><span class=""> </span><span class="">beta_Y_c_typ</span><span class=""> </span><span class="">assms</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1">qed</span><span class="">
</span><span class="keyword2">end</span></pre>

</div>
</body>
</html>
